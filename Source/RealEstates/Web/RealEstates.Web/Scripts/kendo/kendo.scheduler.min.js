/*
* Kendo UI v2014.2.1008 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.dropdownlist.min","./kendo.editable.min","./kendo.multiselect.min","./kendo.window.min","./kendo.datetimepicker.min","./kendo.scheduler.recurrence.min","./kendo.scheduler.view.min","./kendo.scheduler.dayview.min","./kendo.scheduler.agendaview.min","./kendo.scheduler.monthview.min","./kendo.mobile.actionsheet.min","./kendo.mobile.pane.min"],e)}(function(){return function(e,t){function n(e,t){return t=t||"",e.startTimezone&&(t=e.startTimezone,e.endTimezone&&(t+=" | "+e.endTimezone)),t}function i(e,t){var n=t.timezone;n&&(e[A.attr("timezone")]=n)}function r(e,t){var n,i=t.model.fields[t.field].validation;i&&(n=i.dateCompare,n&&U(n)&&n.message&&(e[A.attr("dateCompare-msg")]=n.message))}function o(e,t){return function(n){return n=e(n),s(n,"apply",t),n||[]}}function a(e,t){return function(n){return n&&("[object Array]"===q.call(n)||n instanceof A.data.ObservableArray||(n=[n])),s(n,"remove",t,!0),n=e(n),n||[]}}function s(e,t,n,i){var r,o,a;for(e=e||[],o=0,a=e.length;a>o;o++)r=e[o],i?r.startTimezone||r.endTimezone?n?(r.start=A.timezone.convert(r.start,r.startTimezone||r.endTimezone,n),r.end=A.timezone.convert(r.end,r.endTimezone||r.startTimezone,n),r.start=A.timezone[t](r.start,n),r.end=A.timezone[t](r.end,n)):(r.start=A.timezone[t](r.start,r.startTimezone||r.endTimezone),r.end=A.timezone[t](r.end,r.endTimezone||r.startTimezone)):n&&(r.start=A.timezone[t](r.start,n),r.end=A.timezone[t](r.end,n)):r.startTimezone||r.endTimezone?(r.start=A.timezone[t](r.start,r.startTimezone||r.endTimezone),r.end=A.timezone[t](r.end,r.endTimezone||r.startTimezone),n&&(r.start=A.timezone.convert(r.start,r.startTimezone||r.endTimezone,n),r.end=A.timezone.convert(r.end,r.endTimezone||r.startTimezone,n))):n&&(r.start=A.timezone[t](r.start,n),r.end=A.timezone[t](r.end,n)),i&&delete r.uid;return e}function l(e,t){for(var n,i=e.length,r=0;i>r;r++)if(n=e[r],n.uid===t)return n}function c(e,t,n){return e=n?A.timezone.convert(e,t,n):A.timezone.remove(e,t)}function d(e){var t,n,i,r,o,a,s,l,d,u,h,f;return e.filter("[name=end]").length&&(t=e.closest(".k-scheduler-edit-form"),n=t.find("[name=start]:visible"),i=t.find("[name=end]:visible"),i[0]&&n[0]&&(a=A.widgetInstance(n,A.ui),s=A.widgetInstance(i,A.ui),l=t.data("kendoEditable"),d=l?l.options.model:null,a&&s?(r=a.value(),o=s.value()):(r=A.parseDate(n.val()),o=A.parseDate(i.val())),r&&o))?(d&&(u=n.attr(A.attr("timezone")),h=d.startTimezone,f=d.endTimezone,h=h||f,f=f||h,h&&(r=c(r,h,u),o=c(o,f,u))),o>=r):!0}function u(e,t,n,i){for(var r=e.length,o=[],a=0;r>a;a++)o=o.concat(e[a].expand(t,n,i));return o}function h(e){return delete e.name,delete e.prefix,delete e.remove,delete e.edit,delete e.add,delete e.navigate,e}function f(t){return function(n){e(A.format('<select data-{0}bind="value:{1}">',A.ns,t.field)).appendTo(n).kendoDropDownList({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,optionLabel:"None",template:A.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}function p(t){return function(n){e(A.format('<select data-{0}bind="value:{1}">',A.ns,t.field)).appendTo(n).kendoMultiSelect({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,itemTemplate:A.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField),tagTemplate:A.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}function g(t){return function(n){var i,r,o="",a=t.dataSource.view();for(i=0,r=a.length;r>i;i++)o+=A.format('<option value="{0}">{1}</option>',A.getter(t.dataValueField)(a[i]),A.getter(t.dataTextField)(a[i]));e(A.format('<select data-{0}bind="value:{1}" multiple="multiple" data-{0}value-primitive="{3}">{2}</select>',A.ns,t.field,o,t.valuePrimitive)).appendTo(n)}}function m(e,t){var n,i=e.end.getTime()-e.start.getTime(),r=new Date(e.start.getTime());return A.date.setTime(r,t),n=new Date(r.getTime()),A.date.setTime(n,i,!0),{start:r,end:n}}var v,y,w,_,b,x,k,C,T,S,D,A=window.kendo,E=A.date,P=A.support.input,M=E.MS_PER_DAY,I=E.getDate,z=A.date.getMilliseconds,L=A.recurrence,B=A.keys,F=A.ui,R=F.Widget,O="string",N=F.Popup,H=F.Calendar,V=A.data.DataSource,U=e.isPlainObject,W=e.extend,j=e.proxy,q=Object.prototype.toString,G=e.isArray,$=".kendoScheduler",Q="click",Y="change",K="cancel",X="remove",Z="save",J="add",et="edit",tt=/(?:value:start|value:end)(?:,|$)/,nt=I(new Date),it="recurrenceException",rt="Are you sure you want to delete this event?",ot="Do you want to delete only this event occurrence or the whole series?",at="Do you want to edit only this event occurrence or the whole series?",st='<a class="k-button #=className#" #=attr# href="\\#">#=text#</a>',lt=A.template('<div class="k-floatwrap k-header k-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-navigation"><li class="k-state-default k-nav-today"><a role="button" href="\\#" class="k-link">${messages.today}</a></li><li class="k-state-default k-nav-prev"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-w"></span></a></li><li class="k-state-default k-nav-next"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-e"></span></a></li><li class="k-state-default k-nav-current"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-calendar"></span><span data-#=ns#bind="text: formattedDate"></span></a></li></ul><ul class="k-reset k-header k-scheduler-views">#for(var view in views){#<li class="k-state-default k-view-#= view.toLowerCase() #" data-#=ns#name="#=view#"><a role="button" href="\\#" class="k-link">${views[view].title}</a></li>#}#</ul></div>'),ct=A.template('<div class="k-floatwrap k-header k-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-navigation"><li class="k-state-default k-nav-today"><a role="button" href="\\#" class="k-link">${messages.today}</a></li></ul><ul class="k-reset k-header k-scheduler-views">#for(var view in views){#<li class="k-state-default k-view-#= view.toLowerCase() #" data-#=ns#name="#=view#"><a role="button" href="\\#" class="k-link">${views[view].title}</a></li>#}#</ul></div><div class="k-floatwrap k-header k-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-navigation"><li class="k-state-default k-nav-prev"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-w"></span></a></li><li class="k-state-default k-nav-current"><span data-#=ns#bind="text: formattedDate"></span></li><li class="k-state-default k-nav-next"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-e"></span></a></li></ul></div>'),dt=function(t,n){var o={name:n.field},a=P.date?"":A.attr("role")+'="datepicker" ',s=A.attr("role")+'="datetimepicker" ',l=n.model.isAllDay,c=A.attr("validate")+"='"+!l+"'",d=A.attr("validate")+"='"+l+"'";i(o,n),r(o,n),e('<input type="datetime-local" required '+A.attr("type")+'="date" '+s+A.attr("bind")+'="value:'+n.field+',invisible:isAllDay" '+c+"/>").attr(o).appendTo(t),e('<input type="date" required '+A.attr("type")+'="date" '+a+A.attr("bind")+'="value:'+n.field+',visible:isAllDay" '+d+"/>").attr(o).appendTo(t),e("<span "+A.attr("for")+'="'+n.field+'" class="k-invalid-msg"/>').hide().appendTo(t)},ut=function(t,n){var o={name:n.field},a=n.model.isAllDay,s=A.attr("validate")+"='"+!a+"' ",l=A.attr("validate")+"='"+a+"' ";i(o,n),r(o,n),e('<input type="text" required '+A.attr("type")+'="date" '+A.attr("role")+'="datetimepicker" '+A.attr("bind")+'="value:'+n.field+',invisible:isAllDay" '+s+"/>").attr(o).appendTo(t),e('<input type="text" required '+A.attr("type")+'="date" '+A.attr("role")+'="datepicker" '+A.attr("bind")+'="value:'+n.field+',visible:isAllDay" '+l+"/>").attr(o).appendTo(t),e("<span "+A.attr("bind")+'="text: '+n.field+'Timezone"></span>').appendTo(t),"end"===n.field&&e("<span "+A.attr("bind")+'="text: startTimezone, invisible: endTimezone"></span>').appendTo(t),e("<span "+A.attr("for")+'="'+n.field+'" class="k-invalid-msg"/>').hide().appendTo(t)},ht=function(t,n){e("<div "+A.attr("bind")+'="value:'+n.field+'" />').attr({name:n.field}).appendTo(t).kendoRecurrenceEditor({start:n.model.start,timezone:n.timezone,messages:n.messages})},ft=function(t,n){e("<div "+A.attr("bind")+'="value:'+n.field+'" />').attr({name:n.field}).appendTo(t).kendoMobileRecurrenceEditor({start:n.model.start,timezone:n.timezone,messages:n.messages,pane:n.pane,value:n.model[n.field]})},pt=function(t,i){var r=n(i.model,i.messages.noTimezone);e('<a href="#" class="k-button k-timezone-button" data-bind="invisible:isAllDay">'+r+"</a>").click(i.click).appendTo(t)},gt=function(t,n){e('<a href="#" class="k-button" data-bind="invisible:isAllDay">'+n.messages.timezoneEditorButton+"</a>").click(n.click).appendTo(t)},mt=function(t,n){e("<div "+A.attr("bind")+'="value:'+n.field+'" />').attr({name:n.field}).toggle(n.visible).appendTo(t).kendoMobileTimezoneEditor({optionLabel:n.noTimezone})},vt=function(t,n){e("<div "+A.attr("bind")+'="value:'+n.field+'" />').attr({name:n.field}).toggle(n.visible).appendTo(t).kendoTimezoneEditor({optionLabel:n.noTimezone})},yt=A.Class.extend({init:function(t,n){var i=t.timezone;this.reader=n,n.model&&(this.model=n.model),this.timezone=i,this.data=o(e.proxy(this.data,this),i),this.serialize=a(e.proxy(this.serialize,this),i)},errors:function(e){return this.reader.errors(e)},parse:function(e){return this.reader.parse(e)},data:function(e){return this.reader.data(e)},total:function(e){return this.reader.total(e)},groups:function(e){return this.reader.groups(e)},aggregates:function(e){return this.reader.aggregates(e)},serialize:function(e){return this.reader.serialize(e)}}),wt=A.data.Model.define({init:function(e){var t=this;A.data.Model.fn.init.call(t,e),t._defaultId=t.defaults[t.idField]},_time:function(e){var t=this[e],n=e+"Time";return this[n]?this[n]-A.date.toUtcTime(A.date.getDate(t)):z(t)},_date:function(e){var t=e+"Time";return this[t]?this[t]-this._time(e):A.date.getDate(this[e])},clone:function(t,n){var i=this.uid,r=new this.constructor(e.extend({},this.toJSON(),t));return n||(r.uid=i),r},duration:function(){var e=this.end,t=this.start,n=(e.getTimezoneOffset()-t.getTimezoneOffset())*A.date.MS_PER_MINUTE;return e-t-n},expand:function(e,t,n){return L?L.expand(this,e,t,n):[this]},update:function(e){for(var t in e)this.set(t,e[t]);this.startTime&&this.set("startTime",A.date.toUtcTime(this.start)),this.endTime&&this.set("endTime",A.date.toUtcTime(this.end))},isMultiDay:function(){return this.isAllDay||this.duration()>=A.date.MS_PER_DAY},isException:function(){return!this.isNew()&&this.recurrenceId},isOccurrence:function(){return this.isNew()&&this.recurrenceId},isRecurring:function(){return!(!this.recurrenceRule&&!this.recurrenceId)},isRecurrenceHead:function(){return!(!this.id||!this.recurrenceRule)},toOccurrence:function(t){return t=e.extend(t,{recurrenceException:null,recurrenceRule:null,recurrenceId:this.id||this.recurrenceId}),t[this.idField]=this.defaults[this.idField],this.clone(t,!0)},toJSON:function(){var e=A.data.Model.fn.toJSON.call(this);return e.uid=this.uid,delete e.startTime,delete e.endTime,e},shouldSerialize:function(e){return A.data.Model.fn.shouldSerialize.call(this,e)&&"_defaultId"!==e},set:function(e,t){var n,i,r,o=this.isAllDay||!1;A.data.Model.fn.set.call(this,e,t),"isAllDay"==e&&t!=o&&(n=A.date.getDate(this.start),i=new Date(this.end),r=A.date.getMilliseconds(i),0===r&&t&&(r=M),this.set("start",n),t===!0?(A.date.setTime(i,-r),n>i&&(i=n)):A.date.setTime(i,M-r),this.set("end",i))},id:"id",fields:{id:{type:"number"},title:{defaultValue:"",type:"string"},start:{type:"date",validation:{required:!0}},startTimezone:{type:"string"},end:{type:"date",validation:{required:!0,dateCompare:{value:d,message:"End date should be greater than or equal to the start date"}}},endTimezone:{type:"string"},recurrenceRule:{defaultValue:"",type:"string"},recurrenceException:{defaultValue:"",type:"string"},isAllDay:{type:"boolean",defaultValue:!1},description:{type:"string"}}}),_t=V.extend({init:function(e){V.fn.init.call(this,W(!0,{},{schema:{modelBase:wt,model:wt}},e)),this.reader=new yt(this.options.schema,this.reader)},expand:function(e,t){var n=this.view(),i={};return e&&t&&(t=new Date(t.getTime()+M-1),i={logic:"or",filters:[{logic:"and",filters:[{field:"start",operator:"gte",value:e},{field:"end",operator:"gte",value:e},{field:"start",operator:"lte",value:t}]},{logic:"and",filters:[{field:"start",operator:"lte",value:new Date(e.getTime()+M-1)},{field:"end",operator:"gte",value:e}]}]},n=new A.data.Query(u(n,e,t,this.reader.timezone)).filter(i).toArray()),n},cancelChanges:function(e){e&&e.isOccurrence()&&this._removeExceptionDate(e),V.fn.cancelChanges.call(this,e)},insert:function(e,t){if(t){if(!(t instanceof wt)){var n=t;t=this._createNewModel(),t.accept(n)}return(t.isRecurrenceHead()||t.recurrenceId)&&(t=t.recurrenceId?t:t.toOccurrence(),this._addExceptionDate(t)),V.fn.insert.call(this,e,t)}},remove:function(e){return e.isRecurrenceHead()?this._removeExceptions(e):e.isRecurring()&&this._addExceptionDate(e),V.fn.remove.call(this,e)},_removeExceptions:function(e){for(var t=this.data().slice(0),n=t.shift(),i=e.id;n;)n.recurrenceId===i&&V.fn.remove.call(this,n),n=t.shift();e.set(it,"")},_removeExceptionDate:function(e){var t,n;e.recurrenceId&&(t=this.get(e.recurrenceId),t&&(n=e.start,t.set(it,t.recurrenceException.replace(L.toExceptionString(n,this.reader.timezone),""))))},_addExceptionDate:function(e){var t=e.start,n=this.reader.timezone,i=this.get(e.recurrenceId),r=i.recurrenceException||"";L.isException(r,t,n)||i.set(it,r+L.toExceptionString(t,n))}});_t.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},n=t.data;if(t.data=n,!(t instanceof _t)&&t instanceof A.data.DataSource)throw Error("Incorrect DataSource type. Only SchedulerDataSource instances are supported");return t instanceof _t?t:new _t(t)},W(!0,A.data,{SchedulerDataSource:_t,SchedulerDataReader:yt,SchedulerEvent:wt}),v={update:{text:"Save",className:"k-primary k-scheduler-update"},canceledit:{text:"Cancel",className:"k-scheduler-cancel"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-primary k-scheduler-delete",iconClass:"k-icon"}},y={mobile:{dateRange:dt,timezonePopUp:pt,timezone:mt,recurrence:ft,description:'<textarea name="description" class="k-textbox"/>',multipleResources:g,resources:f},desktop:{dateRange:ut,timezonePopUp:gt,timezone:vt,recurrence:ht,description:'<textarea name="description" class="k-textbox"/>',multipleResources:p,resources:f}},w=A.Observable.extend({init:function(e,t){A.Observable.fn.init.call(this),this.element=e,this.options=W(!0,{},this.options,t),this.createButton=this.options.createButton,this.toggleDateValidationHandler=j(this._toggleDateValidation,this)},_toggleDateValidation:function(t){if("isAllDay"==t.field){var n,i,r,o=this.container,a=this.editable.options.model.isAllDay,s=A.attr("bind");o.find("["+s+"*=end],["+s+"*=start]").each(function(){n=e(this),tt.test(n.attr(s))&&(i=n.is("["+A.attr("role")+"=datetimepicker],[type*=datetime]"),r=a!==i,n.attr(A.attr("validate"),r))})}},fields:function(e,t){var n,i,r=this,o=r.options.messages,a=r.options.timezone,s=function(e){e.preventDefault(),r._initTimezoneEditor(t,this)},l=[{field:"title",title:o.editor.title},{field:"start",title:o.editor.start,editor:e.dateRange,timezone:a},{field:"end",title:o.editor.end,editor:e.dateRange,timezone:a},{field:"isAllDay",title:o.editor.allDayEvent}];A.timezone.windows_zones&&(l.push({field:"timezone",title:o.editor.timezone,editor:e.timezonePopUp,click:s,messages:o.editor,model:t}),l.push({field:"startTimezone",title:o.editor.startTimezone,editor:e.timezone,noTimezone:o.editor.noTimezone}),l.push({field:"endTimezone",title:o.editor.endTimezone,editor:e.timezone,noTimezone:o.editor.noTimezone})),t.recurrenceId||l.push({field:"recurrenceRule",title:o.editor.repeat,editor:e.recurrence,timezone:a,messages:o.recurrenceEditor,pane:this.pane}),"description"in t&&l.push({field:"description",title:o.editor.description,editor:e.description});for(n=0;this.options.resources.length>n;n++)i=this.options.resources[n],l.push({field:i.field,title:i.title,editor:i.multiple?e.multipleResources(i):e.resources(i)});return l},end:function(){return this.editable.end()},_buildEditTemplate:function(e,t,n){var i,r,o,a,s=this.options.messages,l=W({},A.Template,this.options.templateSettings),c=l.paramName,d=this.options.editable.template,u="";if(d)typeof d===O&&(d=window.unescape(d)),u+=A.template(d,l)(e);else for(i=0,r=t.length;r>i;i++)o=t[i],"startTimezone"===o.field&&(u+='<div class="k-popup-edit-form k-scheduler-edit-form k-scheduler-timezones" style="display:none">',u+='<div class="k-edit-form-container">',u+='<div class="k-edit-label"></div>',u+='<div class="k-edit-field"><label class="k-check"><input class="k-timezone-toggle" type="checkbox" />'+s.editor.separateTimezones+"</label></div>"),u+='<div class="k-edit-label"><label for="'+o.field+'">'+(o.title||o.field||"")+"</label></div>",!e.editable||e.editable(o.field)?(n.push(o),u+="<div "+A.attr("container-for")+'="'+o.field+'" class="k-edit-field"></div>'):(a="#:",o.field?(o=A.expr(o.field,c),a+=o+"==null?'':"+o):a+="''",a+="#",a=A.template(a,l),u+='<div class="k-edit-field">'+a(e)+"</div>"),"endTimezone"===o.field&&(u+=this._createEndTimezoneButton());return u},_createEndTimezoneButton:function(){return"</div></div>"},_revertTimezones:function(e){e.set("startTimezone",this._startTimezone),e.set("endTimezone",this._endTimezone),delete this._startTimezone,delete this._endTimezone}}),_=w.extend({init:function(){w.fn.init.apply(this,arguments),this.pane=A.mobile.ui.Pane.wrap(this.element),this.pane.element.parent().css("height",this.options.height),this.view=this.pane.view(),this._actionSheetButtonTemplate=A.template('<li><a #=attr# class="k-button #=className#" href="\\#">#:text#</a></li>'),this._actionSheetPopupOptions=e(document.documentElement).hasClass("km-root")?{modal:!1}:{align:"bottom center",position:"bottom center",effect:"slideIn:up"}},options:{animations:{left:"slide",right:"slide:right"}},destroy:function(){this.close(),this.unbind(),this.pane.destroy()},_initTimezoneEditor:function(t){var i,r=this,o=r.pane,a=r.options.messages,s=r.timezoneView,l=r.container.find(".k-scheduler-timezones"),c=l.find(".k-timezone-toggle"),d=l.find(".k-edit-label:last").add(l.find(".k-edit-field:last")),u=function(e){if("startTimezone"===e.field){var n=t.startTimezone;c.prop("disabled",!n),n||(d.hide(),t.set("endTimezone",""),c.prop("checked",!1))}};r._startTimezone=t.startTimezone||"",r._endTimezone=t.endTimezone||"",s||(i='<div data-role="view" class="k-popup-edit-form k-scheduler-edit-form k-mobile-list"><div data-role="header" class="k-header"><a href="#" class="k-button k-scheduler-cancel">'+a.cancel+"</a>"+a.editor.timezoneTitle+'<a href="#" class="k-button k-scheduler-update">'+a.save+"</a></div></div>",this.timezoneView=s=o.append(i),s.contentElement().append(l.show()),s.element.on(Q+$,".k-scheduler-cancel, .k-scheduler-update",function(i){var s,l;i.preventDefault(),i.stopPropagation(),e(this).hasClass("k-scheduler-cancel")&&r._revertTimezones(t),t.unbind("change",u),s=o.element.find("#edit").data("kendoMobileView"),l=n(t,a.editor.noTimezone),s.contentElement().find(".k-timezone-button").text(l),o.navigate(s,r.options.animations.right)}),c.click(function(){d.toggle(c.prop("checked")),t.set("endTimezone","")}),t.bind("change",u)),c.prop("checked",t.endTimezone).prop("disabled",!t.startTimezone),t.endTimezone?d.show():d.hide(),o.navigate(s,r.options.animations.left)},_createActionSheetButton:function(e){return e.template=this._actionSheetButtonTemplate,this.createButton(e)},showDialog:function(t){var n,i,r="",o='<ul><li class="km-actionsheet-title">'+t.title+"</li>",a=this.element.find(".k-event["+A.attr("uid")+"='"+t.model.uid+"']");for(this.container&&(a=this.container.find(".k-scheduler-delete"),a[0]&&(r="phone")),n=0;t.buttons.length>n;n++)o+=this._createActionSheetButton(t.buttons[n]);o+="</ul>",i=e(o).appendTo(this.pane.view().element).kendoMobileActionSheet({type:r,cancel:this.options.messages.cancel,cancelTemplate:'<li class="km-actionsheet-cancel"><a class="k-button" href="\\#">#:cancel#</a></li>',close:function(){this.destroy()},command:function(n){var r=i.element.find("li:not(.km-actionsheet-cancel) > .k-button").index(e(n.currentTarget));r>-1&&(i.close(),t.buttons[r].click())},popup:this._actionSheetPopupOptions}).data("kendoMobileActionSheet"),i.open(a)},editEvent:function(t){var n,i,r,o,a,s=this.pane,l="",c=this.options.messages,d=c.save,u=c.destroy,h=c.cancel,f=c.editor.editorTitle;return l+='<div data-role="view" class="k-popup-edit-form k-scheduler-edit-form k-mobile-list" id="edit" '+A.attr("uid")+'="'+t.uid+'"><div data-role="header" class="k-header"><a href="#" class="k-button k-scheduler-cancel">'+h+"</a>"+f+'<a href="#" class="k-button k-scheduler-update">'+d+"</a></div>",n=this.fields(y.mobile,t),i=this,r=[],l+=this._buildEditTemplate(t,n,r),!t.isNew()&&this.options.editable&&this.options.editable.destroy!==!1&&(l+='<div class="k-edit-buttons"><a href="#" class="k-scheduler-delete k-button">'+u+"</a></div>"),l+="</div>",o=s.append(l),a=this.container=o.element,this.editable=a.kendoEditable({fields:r,model:t,clearContainer:!1,target:i.options.target,validateOnBlur:!0}).data("kendoEditable"),a.find("input[type=checkbox],input[type=radio]").parent(".k-edit-field").addClass("k-check").prev(".k-edit-label").addClass("k-check").click(function(){e(this).next().children("input").click()}),this.trigger("edit",{container:a,model:t})?this.trigger("cancel",{container:a,model:t}):(a.on(Q+$,"a.k-scheduler-edit, a.k-scheduler-cancel, a.k-scheduler-update, a.k-scheduler-delete",function(n){var r,o;n.preventDefault(),n.stopPropagation(),r=e(this),r.hasClass("k-scheduler-edit")?s.navigate("#edit",i.options.animations.right):(o="cancel",r.hasClass("k-scheduler-update")?o="save":r.hasClass("k-scheduler-delete")&&(o="remove"),i.trigger(o,{container:a,model:t}))}),s.navigate(o,i.options.animations.left),t.bind("change",i.toggleDateValidationHandler)),this.editable},_views:function(){return this.pane.element.find(A.roleSelector("view")).not(this.view.element)},close:function(){var e,t,n,i;if(this.container){for(this.pane.navigate("",this.options.animations.right),e=this._views(),n=0,i=e.length;i>n;n++)t=e.eq(n).data("kendoMobileView"),t&&t.purge();e.remove(),this.container=null,this.editable&&(this.editable.options.model.unbind("change",this.toggleDateValidationHandler),this.editable.destroy(),this.editable=null),this.timezoneView=null}}}),b=w.extend({destroy:function(){this.close(),this.unbind()},editEvent:function(e){return this.editable=this._createPopupEditor(e)},close:function(){var e=this,t=function(){e.editable&&(e.editable.options.model.unbind("change",e.toggleDateValidationHandler),e.editable.destroy(),e.editable=null,e.container=null),e.popup&&(e.popup.destroy(),e.popup=null)};e.editable?(e._timezonePopup&&e._timezonePopup.data("kendoWindow")&&(e._timezonePopup.data("kendoWindow").destroy(),e._timezonePopup=null),e.container.is(":visible")?e.container.data("kendoWindow").bind("deactivate",t).close():t()):t()},_createEndTimezoneButton:function(){var e=this.options.messages,t="";return t+='<div class="k-edit-buttons k-state-default">',t+=this.createButton({name:"savetimezone",text:e.save})+this.createButton({name:"canceltimezone",text:e.cancel}),t+="</div></div></div>"},showDialog:function(t){var n,i,r,o=A.format("<div class='k-popup-edit-form'><div class='k-edit-form-container'><p class='k-popup-message'>{0}</p>",t.text);for(o+='<div class="k-edit-buttons k-state-default">',n=0;t.buttons.length>n;n++)o+=this.createButton(t.buttons[n]);o+="</div></div></div>",i=this.element,this.popup&&this.popup.destroy(),r=this.popup=e(o).appendTo(i).eq(0).on("click",".k-button",function(n){n.preventDefault(),r.close();var i=e(n.currentTarget).index();t.buttons[i].click()}).kendoWindow({modal:!0,resizable:!1,draggable:!1,title:t.title,visible:!1,close:function(){this.destroy(),i.focus()}}).getKendoWindow(),r.center().open()},_createPopupEditor:function(t){var n,i,r,o,a=this,s=a.options.editable,l="<div "+A.attr("uid")+'="'+t.uid+'" class="k-popup-edit-form k-scheduler-edit-form"><div class="k-edit-form-container">',c=a.options.messages,d=c.save,u=c.cancel,h=c.destroy,f=this.fields(y.desktop,t),p=[];return l+=this._buildEditTemplate(t,f,p),i=U(s)?s.window:{},l+='<div class="k-edit-buttons k-state-default">',l+=this.createButton({name:"update",text:d,attr:n})+this.createButton({name:"canceledit",text:u,attr:n}),t.isNew()||s.destroy===!1||(l+=this.createButton({name:"delete",text:h,attr:n})),l+="</div></div></div>",r=this.container=e(l).appendTo(a.element).eq(0).kendoWindow(W({modal:!0,resizable:!1,draggable:!0,title:c.editor.editorTitle,visible:!1,close:function(e){e.userTriggered&&a.trigger(K,{container:r,model:t})&&e.preventDefault()}},i)),o=r.kendoEditable({fields:p,model:t,clearContainer:!1,validateOnBlur:!0,target:a.options.target}).data("kendoEditable"),a.trigger(et,{container:r,model:t})?a.trigger(K,{container:r,model:t}):(r.data("kendoWindow").center().open(),r.on(Q+$,"a.k-scheduler-cancel",function(e){e.preventDefault(),e.stopPropagation(),a.trigger(K,{container:r,model:t})}),r.on(Q+$,"a.k-scheduler-update",function(e){e.preventDefault(),e.stopPropagation(),a.trigger("save",{container:r,model:t})}),r.on(Q+$,"a.k-scheduler-delete",function(e){e.preventDefault(),e.stopPropagation(),a.trigger(X,{container:r,model:t})}),t.bind("change",a.toggleDateValidationHandler)),o},_initTimezoneEditor:function(e,t){var n,i=this,r=i.container.find(".k-scheduler-timezones"),o=r.find(".k-timezone-toggle"),a=r.find(".k-edit-label:last").add(r.find(".k-edit-field:last")),s=r.find(".k-scheduler-savetimezone"),l=r.find(".k-scheduler-canceltimezone"),c=i._timezonePopup,d=function(t){if("startTimezone"===t.field){var n=e.startTimezone;o.prop("disabled",!n),n||(a.hide(),e.set("endTimezone",""),o.prop("checked",!1))}};i._startTimezone=e.startTimezone,i._endTimezone=e.endTimezone,c||(i._timezonePopup=c=r.kendoWindow({modal:!0,resizable:!1,draggable:!0,title:i.options.messages.editor.timezoneEditorTitle,visible:!1,close:function(n){e.unbind("change",d),n.userTriggered&&i._revertTimezones(e),t&&t.focus()}}),o.click(function(){a.toggle(o.prop("checked")),e.set("endTimezone","")}),s.click(function(e){e.preventDefault(),n.close()}),l.click(function(t){t.preventDefault(),i._revertTimezones(e),n.close()}),e.bind("change",d)),o.prop("checked",e.endTimezone).prop("disabled",!e.startTimezone),e.endTimezone?a.show():a.hide(),n=c.data("kendoWindow"),n.center().open()}}),x=R.extend({init:function(t,n){var i=this;R.fn.init.call(i,t,n),i.options.views&&i.options.views.length||(i.options.views=["day","week"]),i.resources=[],i._initModel(),i._wrapper(),i._views(),i._toolbar(),i._dataSource(),i._resources(),i._resizeHandler=j(i.resize,i),i.wrapper.on("mousedown"+$+" selectstart"+$,function(e){e.preventDefault()}),i.options.editable&&i.options.editable.resize!==!1&&i._resizable(),i._movable(),e(window).on("resize"+$,i._resizeHandler),i.options.messages&&i.options.messages.recurrence&&(L.options=i.options.messages.recurrence),i._selectable(),i._ariaId=A.guid(),i._createEditor()},_isMobile:function(){var e=this.options;return e.mobile===!0&&A.support.mobileOS||"phone"===e.mobile||"tablet"===e.mobile},_isMobilePhoneView:function(){var e=this.options;return e.mobile===!0&&A.support.mobileOS&&!A.support.mobileOS.tablet||"phone"===e.mobile},_selectable:function(){var t,n=this,i=n.wrapper,r=A.support.mobileOS?"touchend":"mousedown";n.options.selectable&&(n._tabindex(),i.on(r+$,".k-scheduler-header-all-day td, .k-scheduler-content td, .k-event",function(e){var t=e.which,r=e.button,o=A.support.browser,a=t&&3===t||r&&2==r;A.support.mobileOS&&e.isDefaultPrevented()||(a||n._createSelection(e.currentTarget),i.focus(),o.msie&&9>o.version&&setTimeout(function(){i.focus()}))}),t=e.proxy(n._mouseMove,n),i.on("mousedown"+$,".k-scheduler-header-all-day td, .k-scheduler-content td",function(e){var n=e.which,r=e.button,o=n&&3===n||r&&2==r;o||i.on("mousemove"+$,".k-scheduler-header-all-day td, .k-scheduler-content td",t)}),i.on("mouseup"+$+" mouseleave"+$,function(){i.off("mousemove"+$,".k-scheduler-header-all-day td, .k-scheduler-content td",t)}),i.on("focus"+$,function(){n._selection||n._createSelection(e(".k-scheduler-content").find("td:first")),n._select()}),i.on("focusout"+$,function(){n.view().clearSelection(),n._ctrlKey=n._shiftKey=!1}),i.on("keydown"+$,j(n._keydown,n)),i.on("keyup"+$,function(e){n._ctrlKey=e.ctrlKey,n._shiftKey=e.shiftKey}))},_select:function(){var e,t,n,i,r=this,o=r.view(),a=r.wrapper,s=o.current(),l=r._selection;s&&(s.removeAttribute("id"),s.removeAttribute("aria-label"),a.removeAttr("aria-activedescendant")),o.select(l),s=o.current(),s&&r._old!==s&&(t=l,n=r._selectedEvents(),i=o._selectedSlots,n[0]?(t=n[0]||l,e=A.format(r.options.messages.ariaEventLabel,t.title,t.start,t.start)):e=A.format(r.options.messages.ariaSlotLabel,t.start,t.end),s.setAttribute("id",r._ariaId),s.setAttribute("aria-label",e),a.attr("aria-activedescendant",r._ariaId),r._old=s,r.trigger("change",{start:l.start,end:l.end,events:n,slots:i,resources:o._resourceBySlot(l)}))},_selectedEvents:function(){for(var e,t=this._selection.events,n=t.length,i=0,r=[];n>i;i++)e=this.occurrenceByUid(t[i]),e&&r.push(e);return r},_mouseMove:function(t){var n=this;clearTimeout(n._moveTimer),n._moveTimer=setTimeout(function(){var i,r,o,a=n.view(),s=n._selection;s&&(i=a.selectionByElement(e(t.currentTarget)),i&&s.groupIndex===i.groupIndex&&(r=i.startDate(),o=i.endDate(),r>=s.end?s.backward=!1:s.start>=o&&(s.backward=!0),s.backward?s.start=r:s.end=o,n._select()))},5)},_viewByIndex:function(e){var t,n=this.views;for(t in n){if(!e)return t;e--}},_keydown:function(t){var n=this,i=t.keyCode,r=n.view(),o=r.options.editable,a=n._selection,s=t.shiftKey;n._ctrlKey=t.ctrlKey,n._shiftKey=t.shiftKey,i===B.TAB?r.moveToEvent(a,s)&&(n._select(),t.preventDefault()):o&&i===B.ENTER?a.events.length?o.update!==!1&&n.editEvent(a.events[0]):o.create!==!1&&(a.isAllDay&&(a=e.extend({},a,{end:A.date.addDays(a.end,-1)})),n.addEvent(W({},a,r._resourceBySlot(a)))):i===B.DELETE&&o!==!1&&o.destroy!==!1?n.removeEvent(a.events[0]):i>=49&&57>=i?n.view(n._viewByIndex(i-49)):r.move(a,i,s)&&(r.inRange(a)?n._select():n.date(a.start),t.preventDefault()),n._adjustSelectedDate()},_createSelection:function(t){var n,i,r;this._selection&&(this._ctrlKey||this._shiftKey)||(this._selection={events:[],groupIndex:0}),t=e(t),r=this._selection,n=t.attr(A.attr("uid")),i=this.view().selectionByElement(t),i&&(r.groupIndex=i.groupIndex||0),n&&(i=l(this._data,n)),i&&i.uid&&(n=[i.uid]),this._updateSelection(i,n),this._adjustSelectedDate()},_updateSelection:function(e,t){var n,i,r=this._selection;e&&r&&(this._shiftKey&&r.start&&r.end?(n=r.end>e.end,i=this.view(),r.end=e.endDate?e.endDate():e.end,n&&i._timeSlotInterval&&A.date.setTime(r.end,-i._timeSlotInterval())):(r.start=e.startDate?e.startDate():e.start,r.end=e.endDate?e.endDate():e.end),r.isAllDay="isDaySlot"in e?e.isDaySlot:e.isAllDay,r.index=e.index,r.events=this._ctrlKey?r.events.concat(t||[]):t||[])},options:{name:"Scheduler",date:nt,editable:!0,autoBind:!0,snap:!0,mobile:!1,timezone:"",allDaySlot:!0,min:new Date(1900,0,1),max:new Date(2099,11,31),messages:{today:"Today",save:"Save",cancel:"Cancel",destroy:"Delete",deleteWindowTitle:"Delete event",ariaSlotLabel:"Selected from {0:t} to {1:t}",ariaEventLabel:"{0} on {1:D} at {2:t}",views:{day:"Day",week:"Week",workWeek:"Work Week",agenda:"Agenda",month:"Month"},recurrenceMessages:{deleteWindowTitle:"Delete Recurring Item",deleteWindowOccurrence:"Delete current occurrence",deleteWindowSeries:"Delete the series",editWindowTitle:"Edit Recurring Item",editWindowOccurrence:"Edit current occurrence",editWindowSeries:"Edit the series"},editor:{title:"Title",start:"Start",end:"End",allDayEvent:"All day event",description:"Description",repeat:"Repeat",timezone:" ",startTimezone:"Start timezone",endTimezone:"End timezone",separateTimezones:"Use separate start and end time zones",timezoneEditorTitle:"Timezones",timezoneEditorButton:"Time zone",timezoneTitle:"Time zones",noTimezone:"No timezone",editorTitle:"Event"}},height:null,width:null,resources:[],group:{resources:[],direction:"horizontal"},views:[],selectable:!1},events:[X,et,K,Z,"add","dataBinding","dataBound","moveStart","move","moveEnd","resizeStart","resize","resizeEnd","navigate","change"],destroy:function(){var t,n=this;
R.fn.destroy.call(n),n.dataSource&&(n.dataSource.unbind(Y,n._refreshHandler),n.dataSource.unbind("progress",n._progressHandler),n.dataSource.unbind("error",n._errorHandler)),n.calendar&&(n.calendar.destroy(),n.popup.destroy()),n.view()&&n.view().destroy(),n._editor&&n._editor.destroy(),this._moveDraggable&&this._moveDraggable.destroy(),this._resizeDraggable&&this._resizeDraggable.destroy(),t=n.element.add(n.wrapper).add(n.toolbar).add(n.popup),t.off($),clearTimeout(n._moveTimer),n._model=null,n.toolbar=null,n.element=null,e(window).off("resize"+$,n._resizeHandler),A.destroy(n.wrapper)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},items:function(){return this.wrapper.find(".k-event, .k-task")},_movable:function(){var n,i,r,o,a,s=this,l=s._isMobile(),c=s.options.editable&&s.options.editable.move!==!1,d=s.options.editable&&s.options.editable.resize!==!1;(c||d&&l)&&(s._moveDraggable=new A.ui.Draggable(s.element,{distance:0,filter:".k-event",ignore:".k-resize-handle",holdToDrag:l}),c&&s._moveDraggable.bind("dragstart",function(e){var o=s.view(),c=e.currentTarget;return o.options.editable&&o.options.editable.move!==!1?l&&!c.hasClass("k-event-active")?(s.element.find(".k-event-active").removeClass("k-event-active"),e.preventDefault(),t):(a=s.occurrenceByUid(c.attr(A.attr("uid"))),n=o._slotByPosition(e.x.location,e.y.location),r=n.startOffset(e.x.location,e.y.location,s.options.snap),i=n,(!n||s.trigger("moveStart",{event:a}))&&e.preventDefault(),t):(e.preventDefault(),t)}).bind("drag",function(e){var t,n,l=s.view(),c=l._slotByPosition(e.x.location,e.y.location);c&&(o=c.startOffset(e.x.location,e.y.location,s.options.snap),t=o-r,l._updateMoveHint(a,c.groupIndex,t),n=m(a,t),s.trigger("move",{event:a,slot:{element:c.element,start:c.startDate(),end:c.endDate()},resources:l._resourceBySlot(c),start:n.start,end:n.end})?l._updateMoveHint(a,c.groupIndex,t):i=c)}).bind("dragend",function(t){var l,c,d,u,h,f,p;s.view()._removeMoveHint(),l=o-r,c=m(a,l),d=c.start,u=c.end,h=s.view()._resourceBySlot(i),f=s.view()._resourceBySlot(n),p=s.trigger("moveEnd",{event:a,slot:{element:i.element,start:i.startDate(),end:i.endDate()},start:d,end:u,resources:h}),p||a.start.getTime()==d.getTime()&&a.end.getTime()==u.getTime()&&A.stringify(h)==A.stringify(f)||s._updateEvent(null,a,e.extend({start:d,end:u},h)),t.currentTarget.removeClass("k-event-active"),this.cancelHold()}).bind("dragcancel",function(){s.view()._removeMoveHint(),this.cancelHold()}),l&&(s._moveDraggable.bind("hold",function(e){s.element.find(".k-scheduler-monthview").length&&e.preventDefault(),s.element.find(".k-event-active").removeClass("k-event-active"),e.currentTarget.addClass("k-event-active")}),s._moveDraggable.userEvents.bind("press",function(e){e.preventDefault()})))},_resizable:function(){function t(e){var t,n={"k-resize-e":"east","k-resize-w":"west","k-resize-n":"north","k-resize-s":"south"};for(t in n)if(e.hasClass(t))return n[t]}var n,i,r,o,a=this;a._resizeDraggable=new A.ui.Draggable(a.element,{distance:0,filter:".k-resize-handle",dragstart:function(t){var s=e(t.currentTarget),l=s.closest(".k-event"),c=l.attr(A.attr("uid"));r=a.occurrenceByUid(c),o=a.view()._slotByPosition(t.x.location,t.y.location),a.trigger("resizeStart",{event:r})&&t.preventDefault(),n=A.date.toUtcTime(r.start),i=A.date.toUtcTime(r.end)},drag:function(s){var l,c,d,u,h,f;o&&(l=e(s.currentTarget),c=t(l),d=a.view(),u=d._slotByPosition(s.x.location,s.y.location),u&&o.groupIndex==u.groupIndex&&(o=u,h=n,f=i,"south"==c?!o.isDaySlot&&o.end-A.date.toUtcTime(r.start)>=d._timeSlotInterval()&&(i=r.isAllDay?o.startOffset(s.x.location,s.y.location,a.options.snap):o.endOffset(s.x.location,s.y.location,a.options.snap)):"north"==c?!o.isDaySlot&&A.date.toUtcTime(r.end)-o.start>=d._timeSlotInterval()&&(n=o.startOffset(s.x.location,s.y.location,a.options.snap)):"east"==c?o.isDaySlot&&A.date.toUtcTime(A.date.getDate(o.endDate()))>=A.date.toUtcTime(A.date.getDate(r.start))&&(i=r.isAllDay?o.startOffset(s.x.location,s.y.location,a.options.snap):o.endOffset(s.x.location,s.y.location,a.options.snap)):"west"==c&&o.isDaySlot&&A.date.toUtcTime(A.date.getDate(r.end))>=A.date.toUtcTime(A.date.getDate(o.startDate()))&&(n=o.startOffset(s.x.location,s.y.location,a.options.snap)),a.trigger("resize",{event:r,slot:{element:o.element,start:o.startDate(),end:o.endDate()},start:A.timezone.toLocalDate(n),end:A.timezone.toLocalDate(i),resources:d._resourceBySlot(o)})?(n=h,i=f):d._updateResizeHint(r,o.groupIndex,n,i)))},dragend:function(s){var l,c=e(s.currentTarget),d=new Date(r.start.getTime()),u=new Date(r.end.getTime()),h=t(c);a.view()._removeResizeHint(),"south"==h?u=A.timezone.toLocalDate(i):"north"==h?d=A.timezone.toLocalDate(n):"east"==h?u=A.date.getDate(A.timezone.toLocalDate(i)):"west"==h&&(d=new Date(A.timezone.toLocalDate(n)),d.setHours(0),d.setMinutes(0)),l=a.trigger("resizeEnd",{event:r,slot:{element:o.element,start:o.startDate(),end:o.endDate()},start:d,end:u,resources:a.view()._resourceBySlot(o)}),!l&&u.getTime()>=d.getTime()&&(r.start.getTime()!=d.getTime()||r.end.getTime()!=u.getTime())&&a._updateEvent(h,r,{start:d,end:u}),o=null,r=null},dragcancel:function(){a.view()._removeResizeHint(),o=null,r=null}})},_updateEvent:function(e,t,n){var i=this,r=function(e,t){try{i._preventRefresh=!0,e.update(n),i._convertDates(e)}finally{i._preventRefresh=!1}i.trigger(Z,{event:e})||(t&&t(),i._updateSelection(e),i.dataSource.sync())},o=function(e){return e.recurrenceRule?i.dataSource.getByUid(e.uid):i.dataSource.get(e.recurrenceId)},a=function(){var a,s,l=o(t);("south"==e||"north"==e)&&(n.start&&(a=A.date.getDate(l.start),A.date.setTime(a,z(n.start)),n.start=a),n.end&&(s=A.date.getDate(l.end),A.date.setTime(s,z(n.end)),n.end=s)),i.dataSource._removeExceptions(l),r(l)},s=function(){var e=o(t),n=function(){i._convertDates(e)},a=e.toOccurrence({start:t.start,end:t.end});r(i.dataSource.add(a),n)},l=i.options.messages.recurrenceMessages;t.recurrenceRule||t.isOccurrence()?i.showDialog({model:t,title:l.editWindowTitle,text:l.editRecurring?l.editRecurring:at,buttons:[{text:l.editWindowOccurrence,click:s},{text:l.editWindowSeries,click:a}]}):r(i.dataSource.getByUid(t.uid))},_modelForContainer:function(t){return t=e(t).closest("["+A.attr("uid")+"]"),this.dataSource.getByUid(t.attr(A.attr("uid")))},showDialog:function(e){this._editor.showDialog(e)},focus:function(){this.wrapper.focus()},_confirmation:function(e,t){var n,i,r,o=this.options.editable;o===!0||o.confirmation!==!1?(n=this.options.messages,i=typeof o.confirmation===O?o.confirmation:rt,r=[{name:"destroy",text:n.destroy,click:function(){e()}}],this._isMobile()&&A.mobile.ui.Pane||r.push({name:"canceledit",text:n.cancel,click:function(){e(!0)}}),this.showDialog({model:t,text:i,title:n.deleteWindowTitle,buttons:r})):e()},addEvent:function(e){var t,n,i=this._editor.editable,r=this.dataSource;e=e||{},n=this.trigger("add",{event:e}),!n&&(i&&i.end()||!i)&&(this.cancelEvent(),e&&e.toJSON&&(e=e.toJSON()),t=r.add(e),t&&(this.cancelEvent(),this._editEvent(t)))},saveEvent:function(){var e,t,n,i=this._editor;i&&(e=i.editable,t=i.container,n=this._modelForContainer(t),t&&e&&e.end()&&!this.trigger(Z,{container:t,event:n})&&(n.isRecurrenceHead()&&this.dataSource._removeExceptions(n),n.dirty||n.isOccurrence()||this._convertDates(n,"remove"),this.dataSource.sync()))},cancelEvent:function(){var e,t=this._editor,n=t.container;n&&(e=this._modelForContainer(n),e&&e.isOccurrence()&&(this._convertDates(e,"remove"),this._convertDates(this.dataSource.get(e.recurrenceId),"remove")),this.dataSource.cancelChanges(e),t.close())},editEvent:function(e){var t="string"==typeof e?this.occurrenceByUid(e):e;t&&(this.cancelEvent(),t.isRecurring()?this._editRecurringDialog(t):this._editEvent(t))},_editEvent:function(e){this._createPopupEditor(e)},_editRecurringDialog:function(e){var t=this,n=function(){e.isException()?t._editEvent(e):t.addEvent(e)},i=function(){e.recurrenceId&&(e=t.dataSource.get(e.recurrenceId)),t._editEvent(e)},r=t.options.messages.recurrenceMessages;t.showDialog({model:e,title:r.editWindowTitle,text:r.editRecurring?r.editRecurring:at,buttons:[{text:r.editWindowOccurrence,click:n},{text:r.editWindowSeries,click:i}]})},_createButton:function(e){var t=e.template||st,n=typeof e===O?e:e.name||e.text,i={className:"k-scheduler-"+(n||"").replace(/\s/g,""),text:n,attr:""};if(!(n||U(e)&&e.template))throw Error("Custom commands should have name specified");return U(e)?(e.className&&(e.className+=" "+i.className),"edit"===n&&U(e.text)&&(e=W(!0,{},e),e.text=e.text.edit),i=W(!0,i,v[n],e)):i=W(!0,i,v[n]),A.template(t)(i)},_convertDates:function(e,t){var n=this.dataSource.reader.timezone,i=e.startTimezone,r=e.endTimezone,o=e.start,a=e.start;t=t||"apply",i=i||r,r=r||i,i&&(n?"apply"===t?(o=A.timezone.convert(e.start,n,i),a=A.timezone.convert(e.end,n,r)):(o=A.timezone.convert(e.start,i,n),a=A.timezone.convert(e.end,r,n)):(o=A.timezone[t](e.start,i),a=A.timezone[t](e.end,r)),e._set("start",o),e._set("end",a))},_createEditor:function(){var e,n=this;e=n._editor=this._isMobile()&&A.mobile.ui.Pane?new _(this.wrapper,W({},this.options,{target:this,timezone:n.dataSource.reader.timezone,resources:n.resources,createButton:j(this._createButton,this)})):new b(this.wrapper,W({},this.options,{target:this,createButton:j(this._createButton,this),timezone:n.dataSource.reader.timezone,resources:n.resources})),e.bind("cancel",function(e){return n.trigger("cancel",{container:e.container,event:e.model})?(e.preventDefault(),t):(n.cancelEvent(),n.focus(),t)}),e.bind("edit",function(e){n.trigger(et,{container:e.container,event:e.model})&&e.preventDefault()}),e.bind("save",function(){n.saveEvent()}),e.bind("remove",function(e){n.removeEvent(e.model)})},_createPopupEditor:function(e){var t=this._editor;(!e.isNew()||e.isOccurrence())&&(e.isOccurrence()&&this._convertDates(e.recurrenceId?this.dataSource.get(e.recurrenceId):e),this._convertDates(e)),this.editable=t.editEvent(e)},removeEvent:function(e){var t=this,n="string"==typeof e?t.occurrenceByUid(e):e;n&&(n.isRecurring()?t._deleteRecurringDialog(n):t._confirmation(function(e){e||t._removeEvent(n)},n))},occurrenceByUid:function(e){var t=this.dataSource.getByUid(e);return t||(t=l(this._data,e)),t},occurrencesInRange:function(e,t){return new A.data.Query(this._data).filter({logic:"or",filters:[{logic:"and",filters:[{field:"start",operator:"gte",value:e},{field:"end",operator:"gte",value:e},{field:"start",operator:"lt",value:t}]},{logic:"and",filters:[{field:"start",operator:"lte",value:e},{field:"end",operator:"gt",value:e}]}]}).toArray()},_removeEvent:function(e){this.trigger(X,{event:e})||this.dataSource.remove(e)&&this.dataSource.sync()},_deleteRecurringDialog:function(e){var t=this,n=e,i=function(){var e=n.recurrenceId?n:n.toOccurrence(),i=t.dataSource.get(e.recurrenceId);t._convertDates(i),t._removeEvent(e)},r=function(){n.recurrenceId&&(n=t.dataSource.get(n.recurrenceId)),t._removeEvent(n)},o=t.options.messages.recurrenceMessages;t.showDialog({model:e,title:o.deleteWindowTitle,text:o.deleteRecurring?o.deleteRecurring:ot,buttons:[{text:o.deleteWindowOccurrence,click:i},{text:o.deleteWindowSeries,click:r}]})},_unbindView:function(e){e.destroy()},_bindView:function(e){var t=this;t.options.editable&&(t._viewRemoveHandler&&e.unbind(X,t._viewRemoveHandler),t._viewRemoveHandler=function(e){t.removeEvent(e.uid)},e.bind(X,t._viewRemoveHandler),t._viewAddHandler&&e.unbind(J,t._viewAddHandler),t._viewAddHandler=function(e){t.addEvent(e.eventInfo)},e.bind(J,this._viewAddHandler),t._viewEditHandler&&e.unbind(et,t._viewEditHandler),t._viewEditHandler=function(e){t.editEvent(e.uid)},e.bind(et,this._viewEditHandler)),t._viewNavigateHandler&&e.unbind("navigate",t._viewNavigateHandler),t._viewNavigateHandler=function(e){var n,i;e.view&&(n="isWorkDay"in e,i=n?"changeWorkDay":"changeView",t.trigger("navigate",{view:e.view,isWorkDay:e.isWorkDay,action:i,date:e.date})||(n&&(t._workDayMode=e.isWorkDay),t._selectView(e.view),t.date(e.date)))},e.bind("navigate",t._viewNavigateHandler),t._viewActivateHandler&&e.unbind("activate",t._viewActivateHandler),t._viewActivateHandler=function(){var e=this;t._selection&&(e.constrainSelection(t._selection),t._select(),t._adjustSelectedDate())},e.bind("activate",t._viewActivateHandler)},_selectView:function(e){var t=this;e&&t.views[e]&&(t._selectedView&&t._unbindView(t._selectedView),t._selectedView=t._renderView(e),t._selectedViewName=e,t.toolbar.find(".k-scheduler-views li").removeClass("k-state-selected").end().find(".k-view-"+e.replace(/\./g,"\\.").toLowerCase()).addClass("k-state-selected"))},view:function(e){var n=this;return e?(n._selectView(e),n.rebind(),t):n._selectedView},_renderView:function(e){var t=this._initializeView(e);return this._bindView(t),this._model.set("formattedDate",t.dateForTitle()),t},resize:function(e){var t=this.getSize(),n=this._size,i=this.view();i&&i.groups&&(e||!n||t.width!==n.width||t.height!==n.height)&&(this.refresh({action:"resize"}),this._size=t)},_adjustSelectedDate:function(){var e=this._model.selectedDate,t=this._selection,n=t.start;n&&!A.date.isInDateRange(e,I(n),I(t.end))&&e.setFullYear(n.getFullYear(),n.getMonth(),n.getDate())},_initializeView:function(e){var t,n,i=this.views[e];if(i){if(t=U(i),n=i.type,typeof n===O&&(n=A.getter(i.type)(window)),!n)throw Error("There is no such view");i=new n(this.wrapper,h(W(!0,{},this.options,t?i:{},{resources:this.resources,date:this.date(),showWorkHours:this._workDayMode})))}return i},_views:function(){var e,t,n,i,r,o,a,s,l,c=this.options.views;for(this.views={},a=0,s=c.length;s>a;a++)l=!1,e=c[a],i=U(e),i?(o=r=e.type?e.type:e,typeof o!==O&&(r=e.title,l=!0)):o=r=e,t=k[r],t&&!l&&(e.type=t.type,t.title=this.options.messages.views[r],"day"===t.type?t.messages={allDay:this.options.messages.allDay}:"agenda"===t.type&&(t.messages={event:this.options.messages.event,date:this.options.messages.date,time:this.options.messages.time})),e=W({title:r},t,i?e:{}),r&&(this.views[r]=e,(!n||e.selected)&&(n=r));n&&(this._selectedViewName=n)},rebind:function(){this.dataSource.fetch()},_dataSource:function(){var e=this,t=e.options,n=t.dataSource;n=G(n)?{data:n}:n,!t.timezone||n instanceof _t?n instanceof _t&&(t.timezone=n.schema?n.schema.timezone:""):n=W(!0,n,{schema:{timezone:t.timezone}}),e.dataSource&&e._refreshHandler?e.dataSource.unbind(Y,e._refreshHandler).unbind("progress",e._progressHandler).unbind("error",e._errorHandler):(e._refreshHandler=j(e.refresh,e),e._progressHandler=j(e._requestStart,e),e._errorHandler=j(e._error,e)),e.dataSource=A.data.SchedulerDataSource.create(n).bind(Y,e._refreshHandler).bind("progress",e._progressHandler).bind("error",e._errorHandler),e.options.dataSource=e.dataSource},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_progress:function(e){var t=this.element.find(".k-scheduler-content");A.ui.progress(t,e)},_resources:function(){var t,n,i,r,o,a=this,s=a.options.resources;for(t=0;s.length>t;t++){if(n=s[t],i=n.field,r=n.dataSource,!i||!r)throw Error('The "field" and "dataSource" options of the scheduler resource are mandatory.');a.resources.push({field:i,name:n.name||i,title:n.title||i,dataTextField:n.dataTextField||"text",dataValueField:n.dataValueField||"value",dataColorField:n.dataColorField||"color",valuePrimitive:null!=n.valuePrimitive?n.valuePrimitive:!0,multiple:n.multiple||!1,dataSource:A.data.DataSource.create(r)})}o=e.map(a.resources,function(e){return e.dataSource.fetch()}),e.when.apply(null,o).then(function(){a.options.autoBind?a.view(a._selectedViewName):a._selectView(a._selectedViewName)})},_initModel:function(){var e=this;e._model=A.observable({selectedDate:new Date(this.options.date),formattedDate:""}),e._model.bind("change",function(t){"selectedDate"===t.field&&e.view(e._selectedViewName)})},_wrapper:function(){var e=this,t=e.options,n=t.height,i=t.width;e.wrapper=e.element.addClass("k-widget k-scheduler k-floatwrap").attr("role","grid").attr("aria-multiselectable",!0),e._isMobile()&&e.wrapper.addClass("k-scheduler-mobile"),e._isMobilePhoneView()&&e.wrapper.addClass("k-scheduler-phone"),n&&e.wrapper.height(n),i&&e.wrapper.width(i)},date:function(e){return null!=e&&I(e)>=I(this.options.min)&&I(e)<=I(this.options.max)&&this._model.set("selectedDate",e),I(this._model.get("selectedDate"))},_toolbar:function(){var n=this,i=n.options,r=this._isMobilePhoneView()?ct:lt,o=e(r({messages:i.messages,ns:A.ns,views:n.views}));n.wrapper.append(o),n.toolbar=o,A.bind(n.toolbar,n._model),o.on(Q+$,".k-scheduler-navigation li",function(i){var r=e(this),o=new Date(n.date()),a="";if(i.preventDefault(),r.hasClass("k-nav-today"))a="today",o=new Date;else if(r.hasClass("k-nav-next"))a="next",o=n.view().nextDate();else if(r.hasClass("k-nav-prev"))a="previous",o=n.view().previousDate();else if(r.hasClass("k-nav-current")&&!n._isMobilePhoneView())return n._showCalendar(),t;n.trigger("navigate",{view:n._selectedViewName,action:a,date:o})||n.date(o)}),o.on(Q+$,".k-scheduler-views li",function(t){t.preventDefault();var i=e(this).attr(A.attr("name"));n.trigger("navigate",{view:i,action:"changeView",date:n.date()})||n.view(i)}),o.find("li").hover(function(){e(this).addClass("k-state-hover")},function(){e(this).removeClass("k-state-hover")})},_showCalendar:function(){var t=this,n=t.toolbar.find(".k-nav-current"),i=e('<div class="k-calendar-container"><div class="k-scheduler-calendar"/></div>');t.popup||(t.popup=new N(i,{anchor:n,activate:function(){t.calendar||(t.calendar=new H(this.element.find(".k-scheduler-calendar"),{change:function(){var e=this.value();t.trigger("navigate",{view:t._selectedViewName,action:"changeDate",date:e})||(t.date(e),t.popup.close())},min:t.options.min,max:t.options.max})),t.calendar.value(t.date())},copyAnchorStyles:!1})),t.popup.open()},refresh:function(e){var t=this,n=this.view();this._progress(!1),this.angular("cleanup",function(){return{elements:t.items()}}),e=e||{},n&&(e&&"itemchange"===e.action&&(this._editor.editable||this._preventRefresh)||this.trigger("dataBinding",{action:e.action||"rebind",index:e.index,items:e.items})||(e&&"resize"===e.action||!this._editor||this._editor.close(),this._data=this.dataSource.expand(n.startDate(),n.endDate()),n.render(this._data),this.trigger("dataBound")))},slotByPosition:function(e,t){var n,i=this.view();return i._slotByPosition?(n=i._slotByPosition(e,t),n?{startDate:n.startDate(),endDate:n.endDate(),groupIndex:n.groupIndex,element:n.element,isDaySlot:n.isDaySlot}:null):null},slotByElement:function(t){var n=e(t).offset();return this.slotByPosition(n.left,n.top)},resourcesBySlot:function(e){return this.view()._resourceBySlot(e)}}),k={day:{type:"kendo.ui.DayView"},week:{type:"kendo.ui.WeekView"},workWeek:{type:"kendo.ui.WorkWeekView"},agenda:{type:"kendo.ui.AgendaView"},month:{type:"kendo.ui.MonthView"}},F.plugin(x),C=R.extend({init:function(e,t){var n=this,i=A.timezone.windows_zones;if(!i||!A.timezone.zones_titles)throw Error("kendo.timezones.min.js is not included.");R.fn.init.call(n,e,t),n.wrapper=n.element,n._zonesQuery=new A.data.Query(i),n._zoneTitleId=A.guid(),n._zoneTitlePicker(),n._zonePicker(),n.value(n.options.value)},options:{name:"TimezoneEditor",value:"",optionLabel:"No timezone"},events:["change"],_zoneTitlePicker:function(){var t=this,n=e('<input id="'+t._zoneTitleId+'"/>').appendTo(t.wrapper);t._zoneTitle=new A.ui.DropDownList(n,{dataSource:A.timezone.zones_titles,dataValueField:"other_zone",dataTextField:"name",optionLabel:t.options.optionLabel,cascade:function(){this.value()||t._zone.wrapper.hide()}})},_zonePicker:function(){var t=this,n=e("<input />").appendTo(this.wrapper);t._zone=new A.ui.DropDownList(n,{dataValueField:"zone",dataTextField:"territory",dataSource:t._zonesQuery.data,cascadeFrom:t._zoneTitleId,cascade:function(){t._value=this.value(),t.trigger("change")},dataBound:function(){t._value=this.value(),this.wrapper.toggle(this.dataSource.view().length>1)}}),t._zone.wrapper.hide()},destroy:function(){R.fn.destroy.call(this),A.destroy(this.wrapper)},value:function(e){var n,i=this;return e===t?i._value:(n=i._zonesQuery.filter({field:"zone",operator:"eq",value:e}).data[0],n?(i._zoneTitle.value(n.other_zone),i._zone.value(n.zone)):i._zoneTitle.value(""),t)}}),F.plugin(C),T=A.template('<option value="#=other_zone#">#=name#</option>'),S=A.template('<option value="#=zone#">#=territory#</option>'),D=R.extend({init:function(e,t){var n=this,i=A.timezone.windows_zones;if(!i||!A.timezone.zones_titles)throw Error("kendo.timezones.min.js is not included.");R.fn.init.call(n,e,t),n.wrapper=n.element,n._zonesQuery=new A.data.Query(i),n._zoneTitlePicker(),n._zonePicker(),n.value(n.options.value)},options:{name:"MobileTimezoneEditor",optionLabel:"No timezone",value:""},events:["change"],_bindZones:function(e){var t=e?this._filter(e):[];this._zone.html(this._options(t,S))},_filter:function(e){return this._zonesQuery.filter({field:"other_zone",operator:"eq",value:e}).data},_options:function(e,t,n){var i=0,r="",o=e.length;for(n&&(r+=t({other_zone:"",name:n}));o>i;i++)r+=t(e[i]);return r},_zoneTitlePicker:function(){var t=this,n=t._options(A.timezone.zones_titles,T,t.options.optionLabel);t._zoneTitle=e("<select>"+n+"</select>").appendTo(t.wrapper).change(function(){var e=this.value,n=t._zone;t._bindZones(e),e&&n[0].children.length>1?n.show():n.hide(),t._value=n[0].value,t.trigger("change")})},_zonePicker:function(){var t=this;t._zone=e('<select style="display:none"></select>').appendTo(this.wrapper).change(function(){t._value=this.value,t.trigger("change")}),t._bindZones(t._zoneTitle.val()),t._value=t._zone[0].value},destroy:function(){R.fn.destroy.call(this),A.destroy(this.wrapper)},value:function(e){var n,i=this,r=i._zone,o="",a="";return e===t?i._value:(n=i._zonesQuery.filter({field:"zone",operator:"eq",value:e}).data[0],n&&(a=n.zone,o=n.other_zone),i._zoneTitle.val(o),i._bindZones(o),r.val(a),a=r[0].value,a&&r[0].children.length>1?r.show():r.hide(),i._value=a,t)}}),F.plugin(D)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});