/*
* Kendo UI v2014.2.1008 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.data.min","./kendo.popup.min","./kendo.resizable.min","./kendo.gantt.list.min","./kendo.gantt.timeline.min"],e)}(function(){return function(e,t){function n(e){return"["+d.attr("uid")+(e?"='"+e+"']":"]")}function i(e){return delete e.name,delete e.prefix,delete e.remove,delete e.edit,delete e.add,delete e.navigate,e}function r(e){var t,n,i,r,o,a;return e.filter("[name=end], [name=start]").length?(t=e.closest("td.k-edit-cell"),n=t.data("kendoEditable"),i=e.attr("name"),r=d.widgetInstance(e,d.ui),o=n?n.options.model:null,a={},o?(a.start=o.start,a.end=o.end,a[i]=r?r.value():d.parseDate(e.value()),a.end>=a.start):!0):!0}function o(t,n){var i=t.parents("["+d.attr("role")+'="gantt"]'),r=[],o=a(i);t.attr(b,0),n&&o.each(function(t,n){r[t]=e(n).scrollTop()});try{t[0].setActive()}catch(s){t[0].focus()}n&&o.each(function(t,n){e(n).scrollTop(r[t])})}function a(t){return e(t).parentsUntil("body").filter(function(e,t){var n=d.getComputedStyles(t,["overflow"]);return"visible"!=n.overflow}).add(window)}var s,l,c,d=window.kendo,h=d.support.browser,u=d.Observable,f=d.ui.Widget,p=d.data.DataSource,g=d.data.Query,m=e.isArray,v=e.proxy,y=e.extend,w=e.map,_=d.keys,x=".kendoGantt",b="tabIndex",k="click",C="width",S={down:{origin:"bottom center",position:"top center"},up:{origin:"top center",position:"bottom center"}},T="aria-activedescendant",A="gantt_active_cell",D="action-option-focused",P=".",E=d.template('<div class="#=styles.headerWrapper#">#if (editable == true) {#<div class="#=styles.actions#"><button class="#=styles.button#" data-action="#=action.data#"><span class="#=styles.iconPlus#"></span>#=action.title#</button></div>#}#<ul class="#=styles.viewsWrapper#">#for(var view in views){#<li class="#=styles.viewButtonDefault# #=styles.viewButton#-#= view.toLowerCase() #" data-#=ns#name="#=view#"><a href="\\#" class="#=styles.link#">#=views[view].title#</a></li>#}#</ul></div>'),M=d.template('<div class="#=styles.popupWrapper#"><ul class="#=styles.popupList#" role="listbox">#for(var i = 0, l = actions.length; i < l; i++){#<li class="#=styles.item#" data-action="#=actions[i].data#" role="option">#=actions[i].text#</span>#}#</ul></div>'),I=d.template('<div class="#=styles.footerWrapper#"><div class="#=styles.actions#"><button class="#=styles.button#" data-action="#=action.data#"><span class="#=styles.iconPlus#"></span>#=action.title#</button></div></div>'),L={wrapper:"k-widget k-gantt",listWrapper:"k-gantt-layout k-gantt-treelist",list:"k-gantt-treelist",timelineWrapper:"k-gantt-layout k-gantt-timeline",timeline:"k-gantt-timeline",splitBarWrapper:"k-splitbar k-state-default k-splitbar-horizontal k-splitbar-draggable-horizontal k-gantt-layout",splitBar:"k-splitbar",splitBarHover:"k-splitbar-horizontal-hover",popupWrapper:"k-list-container",popupList:"k-list k-reset",resizeHandle:"k-resize-handle",icon:"k-icon",item:"k-item",line:"k-line",hovered:"k-state-hover",selected:"k-state-selected",focused:"k-state-focused",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",toolbar:{headerWrapper:"k-floatwrap k-header k-gantt-toolbar",footerWrapper:"k-floatwrap k-header k-gantt-toolbar",toolbar:"k-gantt-toolbar",views:"k-gantt-views",viewsWrapper:"k-reset k-header k-gantt-views",actions:"k-gantt-actions",button:"k-button k-button-icontext",iconPlus:"k-icon k-i-plus",viewButtonDefault:"k-state-default",viewButton:"k-view",link:"k-link"}},z=u.extend({init:function(e,t){u.fn.init.call(this),this.element=e,this.options=y(!0,{},this.options,t),this._popup()},options:{direction:"down",navigatable:!1},_current:function(e){var t=c.styles,n=this.list.find(P+t.focused),i=n[e]();i.length&&(n.removeClass(t.focused).removeAttr("id"),i.addClass(t.focused).attr("id",D),this.list.find("ul").removeAttr(T).attr(T,D))},_popup:function(){var t=this,n=c.styles,i="li"+P+n.item,r=this.options.messages.actions,o=this.options.navigatable;this.list=e(M({styles:n,actions:[{data:"add",text:r.addChild},{data:"insert-before",text:r.insertBefore},{data:"insert-after",text:r.insertAfter}]})),this.element.append(this.list),this.popup=new d.ui.Popup(this.list,y({anchor:this.element,open:function(){t._adjustListWidth()},animation:this.options.animation},S[this.options.direction])),this.element.on(k+x,"button",function(i){var r=e(this),a=r.attr(d.attr("action"));i.preventDefault(),a?t.trigger("command",{type:a}):(t.popup.open(),o&&t.list.find("li:first").addClass(n.focused).attr("id",D).end().find("ul").attr({TABINDEX:0,"aria-activedescendant":D}).focus())}),this.list.find(i).hover(function(){e(this).addClass(n.hovered)},function(){e(this).removeClass(n.hovered)}).end().on(k+x,i,function(){t.trigger("command",{type:e(this).attr(d.attr("action"))}),t.popup.close()}),o&&(this.popup.bind("close",function(){t.list.find(i).removeClass(n.focused).end().find("ul").attr(b,0),t.element.parents("["+d.attr("role")+'="gantt"]').find(P+n.gridContent+" > table:first").focus()}),this.list.find("ul").on("keydown"+x,function(e){var i=e.keyCode;switch(i){case _.UP:e.preventDefault(),t._current("prev");break;case _.DOWN:e.preventDefault(),t._current("next");break;case _.ENTER:t.list.find(P+n.focused).click();break;case _.ESC:e.preventDefault(),t.popup.close()}}))},_adjustListWidth:function(){var e,t,n=this.list,i=n[0].style.width,r=this.element;(n.data(C)||!i)&&(e=window.getComputedStyle?window.getComputedStyle(r[0],null):0,t=e?parseFloat(e.width):r.outerWidth(),e&&(h.mozilla||h.msie)&&(t+=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight)+parseFloat(e.borderLeftWidth)+parseFloat(e.borderRightWidth)),i="border-box"!==n.css("box-sizing")?t-(n.outerWidth()-n.width()):t,n.css({fontFamily:r.css("font-family"),width:i}).data(C,i))},destroy:function(){this.popup.destroy(),this.element.off(x),this.list.off(x),this.unbind()}}),B=function(e,t){return function(n){var i,r;if(n=m(i)?{data:n}:n,i=n||{},r=i.data,i.data=r,!(i instanceof e)&&i instanceof p)throw Error("Incorrect DataSource type. Only "+t+" instances are supported");return i instanceof e?i:new e(i)}},R=d.data.Model.define({id:"id",fields:{id:{type:"number"},predecessorId:{type:"number"},successorId:{type:"number"},type:{type:"number"}}}),F=p.extend({init:function(e){p.fn.init.call(this,y(!0,{},{schema:{modelBase:R,model:R}},e))},successors:function(e){return this._dependencies("predecessorId",e)},predecessors:function(e){return this._dependencies("successorId",e)},dependencies:function(e){var t=this.predecessors(e),n=this.successors(e);return t.push.apply(t,n),t},_dependencies:function(e,t){var n=this.view(),i={field:e,operator:"eq",value:t};return n=new g(n).filter(i).toArray()}});F.create=B(F,"GanttDependencyDataSource"),s=d.data.Model.define({duration:function(){var e=this.end,t=this.start;return e-t},isMilestone:function(){return 0===this.duration()},_offset:function(e){var t,n,i=["start","end"];for(n=0;i.length>n;n++)t=new Date(this.get(i[n]).getTime()+e),this.set(i[n],t)},id:"id",fields:{id:{type:"number"},parentId:{type:"number",defaultValue:null,validation:{required:!0}},orderId:{type:"number",validation:{required:!0}},title:{type:"string",defaultValue:""},start:{type:"date",validation:{required:!0,dateCompare:r,message:"Start date should be before or equal to the end date"}},end:{type:"date",validation:{required:!0,dateCompare:r,message:"End date should be after or equal to the start date"}},percentComplete:{type:"number",validation:{required:!0,min:0,max:1,step:.01}},summary:{type:"boolean"},expanded:{type:"boolean",defaultValue:!0}}}),l=p.extend({init:function(e){p.fn.init.call(this,y(!0,{},{schema:{modelBase:s,model:s}},e))},remove:function(e){var t=e.get("parentId");return e=p.fn.remove.call(this,e),this._childRemoved(t,e.get("orderId")),e},add:function(e){return e?(e=this._toGanttTask(e),this.insert(this.taskSiblings(e).length,e)):t},insert:function(e,n){return n?(n=this._toGanttTask(n),n.set("orderId",e),n=p.fn.insert.call(this,e,n),this._reorderSiblings(n,this.taskSiblings(n).length-1),this._resolveSummaryFields(this.taskParent(n)),n):t},taskChildren:function(e){var n,i=this.view(),r={field:"parentId",operator:"eq",value:null},o=this._sort||{field:"orderId",dir:"asc"};if(e){if(n=e.get("id"),n===t||null===n)return[];r.value=n}return i=new g(i).filter(r).sort(o).toArray()},taskAllChildren:function(e){var t=[],n=this,i=function(e){var r=n.taskChildren(e);t.push.apply(t,r),w(r,i)};return e?i(e):t=this.view(),t},taskSiblings:function(e){if(!e)return null;var t=this.taskParent(e);return this.taskChildren(t)},taskParent:function(e){return e&&null!==e.get("parentId")?this.get(e.parentId):null},taskLevel:function(e){for(var t=0,n=this.taskParent(e);null!==n;)t+=1,n=this.taskParent(n);return t},taskTree:function(e){var t,n,i,r,o=[],a=this.taskChildren(e);for(n=0,i=a.length;i>n;n++)t=a[n],o.push(t),t.get("expanded")&&(r=this.taskTree(t),o.push.apply(o,r));return o},update:function(e,n){var i,r,o=this,a=function(e,t){var n,i,r=o.taskAllChildren(e);for(n=0,i=r.length;i>n;n++)r[n]._offset(t)},s=function(e){var t=e.field,n=e.sender;switch(t){case"start":o._resolveSummaryStart(o.taskParent(n)),a(n,n.get(t).getTime()-i.getTime());break;case"end":o._resolveSummaryEnd(o.taskParent(n));break;case"percentComplete":o._resolveSummaryPercentComplete(o.taskParent(n));break;case"orderId":o._reorderSiblings(n,i)}};n.parentId!==t&&(i=e.get("parentId"),i!==n.parentId&&(e.set("parentId",n.parentId),o._childRemoved(i,e.get("orderId")),e.set("orderId",o.taskSiblings(e).length-1),o._resolveSummaryFields(o.taskParent(e))),delete n.parentId),e.bind("change",s);for(r in n)i=e.get(r),e.set(r,n[r]);e.unbind("change",s)},_resolveSummaryFields:function(e){e&&(this._updateSummary(e),this.taskChildren(e).length&&(this._resolveSummaryStart(e),this._resolveSummaryEnd(e),this._resolveSummaryPercentComplete(e)))},_resolveSummaryStart:function(e){var t=this,n=function(e){var n,i,r,o=t.taskChildren(e),a=o[0].start.getTime();for(i=1,r=o.length;r>i;i++)n=o[i].start.getTime(),a>n&&(a=n);return new Date(a)};this._updateSummaryRecursive(e,"start",n)},_resolveSummaryEnd:function(e){var t=this,n=function(e){var n,i,r,o=t.taskChildren(e),a=o[0].end.getTime();for(i=1,r=o.length;r>i;i++)n=o[i].end.getTime(),n>a&&(a=n);return new Date(a)};this._updateSummaryRecursive(e,"end",n)},_resolveSummaryPercentComplete:function(e){var t=this,n=function(e){var n=t.taskChildren(e),i=new g(n).aggregate([{field:"percentComplete",aggregate:"average"}]);return i.percentComplete.average};this._updateSummaryRecursive(e,"percentComplete",n)},_updateSummaryRecursive:function(e,t,n){var i,r;e&&(i=n(e),e.set(t,i),r=this.taskParent(e),r&&this._updateSummaryRecursive(r,t,n))},_childRemoved:function(e,t){var n,i,r=null===e?null:this.get(e),o=this.taskChildren(r);for(n=t,i=o.length;i>n;n++)o[n].set("orderId",n);this._resolveSummaryFields(r)},_reorderSiblings:function(e,t){var n,i=e.get("orderId"),r=i>t,o=r?t:i,a=r?i:t,s=r?o:o+1,l=this.taskSiblings(e);for(a=Math.min(a,l.length-1),n=o;a>=n;n++)l[n]!==e&&(l[n].set("orderId",s),s+=1)},_updateSummary:function(e){if(null!==e){var t=this.taskChildren(e).length;e.set("summary",t>0)}},_toGanttTask:function(e){if(!(e instanceof s)){var t=e;e=this._createNewModel(),e.accept(t)}return e}}),l.create=B(l,"GanttDataSource"),y(!0,d.data,{GanttDataSource:l,GanttTask:s,GanttDependencyDataSource:F,GanttDependency:R}),c=f.extend({init:function(e,t){m(t)&&(t={dataSource:t}),f.fn.init.call(this,e,t),this._wrapper(),this._timeline(),this._toolbar(),this._footer(),this._adjustDimensions(),this._preventRefresh=!0,this.view(this.timeline._selectedViewName),this._preventRefresh=!1,this._dataSource(),this._dropDowns(),this._list(),this._dependencies(),this._resizable(),this._scrollable(),this._dataBind(),this._attachEvents(),d.notify(this)},events:["dataBinding","dataBound","add","edit","remove","cancel","save","change","navigate","moveStart","move","moveEnd","resizeStart","resize","resizeEnd"],options:{name:"Gantt",autoBind:!0,navigatable:!1,selectable:!0,editable:!0,columns:[],views:[],dataSource:{},dependencies:{},messages:{views:{day:"Day",week:"Week",month:"Month"},actions:{append:"Add Task",addChild:"Add Child",insertBefore:"Add Above",insertAfter:"Add Below"}},showWorkHours:!0,showWorkDays:!0,workDayStart:new Date(1980,1,1,8,0,0),workDayEnd:new Date(1980,1,1,17,0,0),workWeekStart:1,workWeekEnd:5,hourSpan:1,snap:!0,height:600,listWidth:"30%"},select:function(e){var n=this.list;return e?(n.select(e),t):n.select()},clearSelection:function(){this.list.clearSelection()},destroy:function(){f.fn.destroy.call(this),this.dataSource&&(this.dataSource.unbind("change",this._refreshHandler),this.dataSource.unbind("progress",this._progressHandler),this.dataSource.unbind("error",this._errorHandler)),this.dependencies&&(this.dependencies.unbind("change",this._dependencyRefreshHandler),this.dependencies.unbind("error",this._dependencyErrorHandler)),this.timeline&&(this.timeline.unbind(),this.timeline.destroy()),this.list&&(this.list.unbind(),this.list.destroy()),this.footerDropDown&&this.footerDropDown.destroy(),this.headerDropDown&&this.headerDropDown.destroy(),this._resizeDraggable&&this._resizeDraggable.destroy(),this.toolbar.off(x),e(window).off("resize"+x,this._resizeHandler),e(this.wrapper).off(x),this.toolbar=null,this.footer=null},_attachEvents:function(){this._resizeHandler=v(this.resize,this),e(window).on("resize"+x,this._resizeHandler)},_wrapper:function(){var e=c.styles,t=[e.icon,e.resizeHandle].join(" "),n=this.options,i=n.height,r=n.width;this.wrapper=this.element.addClass(e.wrapper).append("<div class='"+e.listWrapper+"'><div></div></div>").append("<div class='"+e.splitBarWrapper+"'><div class='"+t+"'></div></div>").append("<div class='"+e.timelineWrapper+"'><div></div></div>"),this.wrapper.find(P+e.list).width(n.listWidth),i&&this.wrapper.height(i),r&&this.wrapper.width(r)},_toolbar:function(){var t=this,n=c.styles,i=P+n.toolbar.views+" > li",r=n.hovered,o=e(E({ns:d.ns,views:this.timeline.views,styles:c.styles.toolbar,action:{data:"add",title:this.options.messages.actions.append},editable:this.options.editable}));this.wrapper.prepend(o),this.toolbar=o,o.on(k+x,i,function(n){n.preventDefault();var i=e(this).attr(d.attr("name"));t.trigger("navigate",{view:i})||t.view(i)}),this.wrapper.find(P+n.toolbar.toolbar+" li").hover(function(){e(this).addClass(r)},function(){e(this).removeClass(r)})},_footer:function(){if(this.options.editable===!0){var t=e(I({styles:c.styles.toolbar,action:{data:"add",title:this.options.messages.actions.append}}));this.wrapper.append(t),this.footer=t}},_adjustDimensions:function(){var e=this.element,t=c.styles,n=P+t.list,i=P+t.timeline,r=P+t.splitBar,o=this.toolbar.outerHeight(),a=this.footer?this.footer.outerHeight():0,s=e.height(),l=e.width(),d=e.find(r).outerWidth(),h=e.find(n).outerWidth();e.children([n,i,r].join(",")).height(s-(o+a)).end().children(i).width(l-(d+h))},_scrollTo:function(e){var t=this.timeline.view(),i=d.attr("uid"),r="string"==typeof e?e:e.closest("tr"+n()).attr(i),o=t.content.find(n(r));0!==o.length&&t._scrollTo(o)},_dropDowns:function(){var e=this,t=P+c.styles.toolbar.actions,n=this.options.messages.actions,i=this.dataSource,r=this.timeline,o=function(t){var n,o=t.type,a=i._createNewModel(),s=e.dataItem(e.select()),l=i.taskParent(s),c=r.view()._timeSlots()[0],d="add"===o?s:l;a.set("title","New task"),d?(a.set("parentId",d.get("id")),a.set("start",d.get("start")),a.set("end",d.get("end"))):(a.set("start",c.start),a.set("end",c.end)),"add"!==o&&(n=s.get("orderId"),n="insert-before"===o?n:n+1),e._createTask(a,n)};this.options.editable===!0&&(this.footerDropDown=new z(this.footer.children(t).eq(0),{messages:{actions:n},direction:"up",animation:{open:{effects:"slideIn:up"}},navigatable:e.options.navigatable}),this.headerDropDown=new z(this.toolbar.children(t).eq(0),{messages:{actions:n},navigatable:e.options.navigatable}),this.footerDropDown.bind("command",o),this.headerDropDown.bind("command",o))},_list:function(){var e=this,t=e.options.navigatable,n=c.styles,i=this.wrapper.find(P+n.list),r=i.find("> div"),a=this.wrapper.find(P+n.toolbar.actions+" > button"),s={columns:this.options.columns||[],dataSource:this.dataSource,selectable:this.options.selectable,editable:this.options.editable,listWidth:i.outerWidth()},l=function(){t&&(e._current(e._cachedCurrent),o(e.list.content.find("table"),!0)),delete e._cachedCurrent};this.list=new d.ui.GanttList(r,s),this.list.bind("render",function(){e._navigatable()},!0).bind("edit",function(t){e._cachedCurrent=t.cell,e.trigger("edit",{task:t.model,container:t.cell})&&t.preventDefault()}).bind("cancel",function(t){e.trigger("cancel",{task:t.model,container:t.cell})&&t.preventDefault(),l()}).bind("update",function(t){e._updateTask(t.task,t.updateInfo),l()}).bind("change",function(){e.trigger("change");var t=e.list.select();t.length?(a.removeAttr("data-action","add"),e.timeline.select("[data-uid='"+t.attr("data-uid")+"']")):(a.attr("data-action","add"),e.timeline.clearSelection())})},_timeline:function(){var e=this,t=c.styles,n=i(y(!0,{},this.options)),r=this.wrapper.find(P+t.timeline+" > div");this.timeline=new d.ui.GanttTimeline(r,n),this.timeline.bind("navigate",function(n){e.toolbar.find(P+t.toolbar.views+" > li").removeClass(t.selected).end().find(P+t.toolbar.viewButton+"-"+n.view.replace(/\./g,"\\.").toLowerCase()).addClass(t.selected),e.refresh()}).bind("moveStart",function(t){e.trigger("moveStart",{task:t.task})&&t.preventDefault()}).bind("move",function(t){var n=t.task,i=t.start,r=new Date(i.getTime()+n.duration());e.trigger("move",{task:n,start:i,end:r})&&t.preventDefault()}).bind("moveEnd",function(t){var n=t.task,i=t.start,r=new Date(i.getTime()+n.duration());e.trigger("moveEnd",{task:n,start:i,end:r})||e._updateTask(e.dataSource.getByUid(n.uid),{start:i,end:r})}).bind("resizeStart",function(t){e.trigger("resizeStart",{task:t.task})&&t.preventDefault()}).bind("resize",function(t){e.trigger("resize",{task:t.task,start:t.start,end:t.end})&&t.preventDefault()}).bind("resizeEnd",function(t){var n=t.task,i={};t.resizeStart?i.start=t.start:i.end=t.end,e.trigger("resizeEnd",{task:n,start:t.start,end:t.end})||e._updateTask(e.dataSource.getByUid(n.uid),i)}).bind("percentResizeEnd",function(t){e._updateTask(e.dataSource.getByUid(t.task.uid),{percentComplete:t.percentComplete})}).bind("dependencyDragEnd",function(t){var n=e.dependencies._createNewModel({type:t.type,predecessorId:t.predecessor.id,successorId:t.successor.id});e._createDependency(n)}).bind("select",function(t){e.select("[data-uid='"+t.uid+"']")}).bind("clear",function(){e.clearSelection()}).bind("removeTask",function(t){e.removeTask(e.dataSource.getByUid(t.uid))}).bind("removeDependency",function(t){e.removeDependency(e.dependencies.getByUid(t.uid))})},_dataSource:function(){var e=this.options,t=e.dataSource;t=m(t)?{data:t}:t,this.dataSource&&this._refreshHandler?this.dataSource.unbind("change",this._refreshHandler).unbind("progress",this._progressHandler).unbind("error",this._errorHandler):(this._refreshHandler=v(this.refresh,this),this._progressHandler=v(this._requestStart,this),this._errorHandler=v(this._error,this)),this.dataSource=d.data.GanttDataSource.create(t).bind("change",this._refreshHandler).bind("progress",this._progressHandler).bind("error",this._errorHandler)},_dependencies:function(){var e=this.options.dependencies||{},t=m(e)?{data:e}:e;this.dependencies&&this._dependencyRefreshHandler?this.dependencies.unbind("change",this._dependencyRefreshHandler).unbind("error",this._dependencyErrorHandler):(this._dependencyRefreshHandler=v(this.refreshDependencies,this),this._dependencyErrorHandler=v(this._error,this)),this.dependencies=d.data.GanttDependencyDataSource.create(t).bind("change",this._dependencyRefreshHandler).bind("error",this._dependencyErrorHandler)},view:function(e){return this.timeline.view(e)},dataItem:function(e){var t,n;return e?(t=this.list,n=t.content.find(e),t._modelFromElement(n)):null},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.list._setDataSource(this.dataSource),this.options.autoBind&&e.fetch()},setDependenciesDataSource:function(e){this.options.dependencies=e,this._dependencies(),this.options.autoBind&&e.fetch()},items:function(){return this.wrapper.children(".k-task")},_updateTask:function(e,t){this.trigger("save",{task:e,values:t})||(this._preventRefresh=!0,this.dataSource.update(e,t),this._syncDataSource())},removeTask:function(e){var t,n="string"==typeof e?this.dataSource.getByUid(e):e;n&&(t=this.dependencies.dependencies(n.id),this.trigger("remove",{task:n,dependencies:t})||(this._removeTaskDependencies(n,t),this._preventRefresh=!0,this.dataSource.remove(n)&&this._syncDataSource(),this._preventRefresh=!1))},_createTask:function(e,n){if(!this.trigger("add",{task:e,dependency:null})){var i=this.dataSource;this._preventRefresh=!0,n===t?i.add(e):i.insert(n,e),this._scrollToUid=e.uid,this._syncDataSource()}},_createDependency:function(e){this.trigger("add",{task:null,dependency:e})||(this._preventDependencyRefresh=!0,this.dependencies.add(e),this._preventDependencyRefresh=!1,this.dependencies.sync())},removeDependency:function(e){var t="string"==typeof e?this.dependencies.getByUid(e):e;this.trigger("remove",{task:null,dependencies:[t]})||this.dependencies.remove(t)&&this.dependencies.sync()},_removeTaskDependencies:function(e,t){this._preventDependencyRefresh=!0;for(var n=0,i=t.length;i>n;n++)this.dependencies.remove(t[n]);this._preventDependencyRefresh=!1,this.dependencies.sync()},refresh:function(){var e,t,i,r,o,a;this._preventRefresh||this.list.editable||(this._progress(!1),e=this.dataSource,t=e.taskTree(),i=this._scrollToUid,a=-1,this.current&&(o=this.current.closest("tr").attr(d.attr("uid")),a=this.current.index()),this.trigger("dataBinding")||(this.clearSelection(),this.list._render(t),this.timeline._render(t),this.timeline._renderDependencies(this.dependencies.view()),i&&(this._scrollTo(i),this.select(n(i))),(i||o)&&a>=0&&(r=this.list.content.find("tr"+n(i||o)+" > td:eq("+a+")"),this._current(r)),this._scrollToUid=null,this.trigger("dataBound")))},refreshDependencies:function(){this._preventDependencyRefresh||this.trigger("dataBinding")||(this.timeline._renderDependencies(this.dependencies.view()),this.trigger("dataBound"))},_syncDataSource:function(){this._preventRefresh=!1,this._requestStart(),this.dataSource.sync()},_requestStart:function(){this._progress(!0)},_error:function(){this._progress(!1)},_progress:function(e){d.ui.progress(this.element,e)},_resizable:function(){var t,n,i,r=this.wrapper,o=c.styles,a=P+o.gridContent,s=r.find(P+o.list),l=r.find(P+o.timeline);this._resizeDraggable=r.find(P+o.splitBar).height(s.height()).hover(function(){e(this).addClass(o.splitBarHover)},function(){e(this).removeClass(o.splitBarHover)}).end().kendoResizable({orientation:"horizontal",handle:P+o.splitBar,start:function(){t=s.width(),n=l.width(),i=l.find(a).scrollLeft()},resize:function(e){var r=e.x.initialDelta;0>t+r||0>n-r||(s.width(t+r),l.width(n-r),l.find(a).scrollLeft(i+r))}}).data("kendoResizable")},_scrollable:function(){var t=c.styles,n=P+t.gridContent,i=P+t.gridHeaderWrap,r=this.timeline.element,o=this.list.element;r.find(n).on("scroll",function(){r.find(i).scrollLeft(this.scrollLeft),o.find(n).scrollTop(this.scrollTop)}),o.find(n).on("scroll",function(){o.find(i).scrollLeft(this.scrollLeft)}).on("DOMMouseScroll"+x+" mousewheel"+x,function(t){var i=r.find(n),o=i.scrollTop(),a=d.wheelDeltaY(t);a&&(t.preventDefault(),e(t.currentTarget).one("wheel"+x,!1),i.scrollTop(o+-a))})},_navigatable:function(){var i,r=this,a=this.options.navigatable,s=this.options.editable,l=this.list.header.find("table"),h=this.list.content.find("table"),u=c.styles,f=this.timeline.element.find(P+u.gridContent),p=l.add(h),g=n(),m={collapse:!1,expand:!0},v=function(e){var t=r.timeline.view()._timeSlots()[0].offsetWidth;f.scrollLeft(f.scrollLeft()+(e?-t:t))},y=function(e){var t=r.current.parent("tr"+n()),i=r.current.index(),a=t[e]();0!==r.select().length&&r.clearSelection(),0!==a.length?(r._current(a.children("td:eq("+i+")")),r._scrollTo(r.current)):r.current.is("td")&&"prev"==e?o(l):r.current.is("th")&&"next"==e&&o(h)},w=function(e){var t=r.current[e]();0!==t.length&&(r._current(t),i=r.current.index())},k=function(e){var t=r.dataItem(r.current);t.summary&&t.expanded!==e&&t.set("expanded",e)},C=function(){var e,t;r.options.editable&&!r.list.editable&&(e=r.select(),t=d.attr("uid"),e.length&&r.removeTask(e.attr(t)))};return e(this.wrapper).on("mousedown"+x,"tr"+g+", div"+g+":not("+P+u.line+")",function(t){var i,l=e(t.currentTarget),c=e(t.target).is(":button,a,:input,a>.k-icon,textarea,span.k-icon,span.k-link,.k-input,.k-multiselect-wrap");t.ctrlKey||(a&&(i=l.is("tr")?e(t.target).closest("td"):r.list.content.find("tr"+n(l.attr(d.attr("uid")))+" > td:first"),r._current(i)),!a&&!s||c||setTimeout(function(){o(r.list.content.find("table"),!0)},2))}),a!==!0?(h.on("keydown"+x,function(e){e.keyCode==_.DELETE&&C()}),t):(p.on("focus"+x,function(){var t=this===h.get(0)?"td":"th",n=(e(this),r.select()),o=r.current||e(n.length?n:this).find(t+":eq("+(i||0)+")");r._current(o)}).on("blur"+x,function(){r._current(),this==l&&e(this).attr(b,-1)}).on("keydown"+x,function(e){var t,n=e.keyCode;if(r.current)switch(t=r.current.is("td"),n){case _.RIGHT:e.preventDefault(),e.altKey?v():e.ctrlKey?k(m.expand):w("next");break;case _.LEFT:e.preventDefault(),e.altKey?v(!0):e.ctrlKey?k(m.collapse):w("prev");break;case _.UP:e.preventDefault(),y("prev");break;case _.DOWN:e.preventDefault(),y("next");break;case _.SPACEBAR:e.preventDefault(),t&&r.select(r.current.closest("tr"));break;case _.ENTER:e.preventDefault(),t?r.options.editable&&(r._cachedCurrent=r.current,r.list._startEditHandler(r.current),e.stopPropagation()):r.current.children("a.k-link").click();break;case _.ESC:e.stopPropagation();break;case _.DELETE:t&&C();break;default:n>=49&&57>=n&&r.view(r.timeline._viewByIndex(n-49))}}),t)},_current:function(t){var n,i=c.styles;this.current&&this.current.length&&this.current.removeClass(i.focused).removeAttr("id"),t&&t.length?(this.current=t.addClass(i.focused).attr("id",A),n=e(d._activeElement()),n.is("table")&&this.wrapper.find(n).length>0&&n.removeAttr(T).attr(T,A)):this.current=null},_dataBind:function(){var t,n=this;n.options.autoBind&&(this._preventRefresh=!0,this._preventDependencyRefresh=!0,t=e.map([this.dataSource,this.dependencies],function(e){return e.fetch()}),e.when.apply(null,t).done(function(){n._preventRefresh=!1,n._preventDependencyRefresh=!1,n.refresh()}))},_resize:function(){this._adjustDimensions(),this.timeline.view()._adjustHeight(),this.list._adjustHeight()}}),d.ui.plugin(c),y(!0,c,{styles:L})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});