/*
* Kendo UI v2014.2.1008 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.dom.min","./kendo.data.min"],e)}(function(){return function(e,t){function n(e){var n="string"==typeof e?{name:e,expand:!1}:e,i="[object Array]"===ht.call(n)?n:n!==t?[n]:[];return pt(i,function(e){return"string"==typeof e?{name:e,expand:!1}:{name:e.name,expand:e.expand}})}function i(e,t,n){var r,o,a,s;for(s=0;t.length>s;s++)r=t[s].members[n],o=r.name,a=r.parentName||"",r.children.length>0?(e[o]=!0,i(e,r.children,n)):a in e||(e[o]=!1)}function r(e){var t,n,r,o,a={};if(e.length)for(t=e[0].members||[],n=0;t.length>n;n++)t[n].measure||i(a,e,n);r=[];for(o in a)r.push({name:o,expand:a[o]});return r}function o(e,t){var n,i,r,o,a=t.tuples||[],s=a[0];if(s&&s.members.length>e.length)for(n=s.members,i=0;n.length>i;i++)if(!n[i].measure){for(r=!1,o=0;e.length>o;o++)if(0===e[o].name.indexOf(n[i].hierarchy)){r=!0;break}r||e.push(n[i])}}function a(e){var t,n=[],i=e.members;for(t=0;i.length>t;t++)i[t].measure||n.push({name:i[t].name,expand:i[t].children.length>0});return n}function s(e,t,i){var r,s;return e=e||{},o(t,e),i.length>1&&t.push({name:"Measures",measure:!0,children:n(i)}),r={members:t},e.tuples&&(s=_(e.tuples,r),s.tuple&&(t=a(s.tuple))),t}function l(e,t,n,i,r,o){var a,s,l,c,d,u,h=0,f=t;for(s in n[i].aggregates)a=n[i].aggregates[s],c=r[s],e[f]={ordinal:f,value:a,fmtValue:c?st.format(c,a):a},++h,f+=o;d=n[i].items;for(l in d){u=d[l].index*h,u=f+u*o;for(s in d[l].aggregates)a=d[l].aggregates[s],c=r[s],e[u]={ordinal:u,value:a,fmtValue:c?st.format(c,a):a},u+=o}}function c(e,t,n,i,r){var o,a,s,l,c,d,u=0;for(a in n[i].aggregates)o=n[i].aggregates[a],l=r[a],e[e.length]={ordinal:t++,value:o,fmtValue:l?st.format(l,o):o},++u;c=n[i].items;for(s in c){d=c[s].index*u;for(a in c[s].aggregates)o=c[s].aggregates[a],l=r[a],e[e.length]={ordinal:t+d++,value:o,fmtValue:l?st.format(l,o):o}}}function d(e){var t=st.getter(e.field,!0);return function(n,i){return e.aggregate(t(n),i)}}function u(e,n,i){return e.tuples.length<g(n.tuples,i)?n:t}function h(e,t,n,i,r){var o,a,s,l=e.length,c=g(t,i),d=i.length||1;for(a=0;n>a;a++)for(o=0;l>o;o++)s=p(e[o],t)*d,s+=o%d,r[a*l+o].ordinal=a*c+s}function f(e,t,n,i,r){var o,a,s,l=e.length,c=(g(t,i),i.length||1);for(a=0;l>a;a++)for(s=p(e[a],t),s*=c,s+=a%c,o=0;n>o;o++)r[a*n+o].ordinal=s*n+o}function p(e,t){return _(t,e).index}function g(e,t){var n,i,r;if(!e.length)return 0;for(n=e.slice(),i=n.shift(),r=1;i;)i.members?[].push.apply(n,i.members):i.children&&(i.measure||(r+=i.children.length),[].push.apply(n,i.children)),i=n.shift();return t.length&&(r*=t.length),r}function m(e){return e||(e={tuples:[]}),e.tuples||(e.tuples=[]),e}function v(e,t,n){var i,r,o;if(!e)return 0;for(i=Math.max(n.length,1),r=e.members.slice(0,t),o=r.shift();o;)o.children?[].push.apply(r,o.children):(i++,[].push.apply(r,o.members)),o=r.shift();return i}function y(e,t,n){var i,r,o,a,s,l;if(!t[0])return{parsedRoot:null,tuples:e,memberIndex:0,index:0};if(i=_(e,t[0]),!i.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};if(r=i.tuple.members,o=t[0].members,a=-1,r.length!==o.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(s=0,l=r.length;l>s;s++)!r[s].measure&&o[s].children[0]&&(-1==a&&o[s].children.length&&(a=s),r[s].children=o[s].children);return n=Math.max(n.length,1),{parsedRoot:i.tuple,index:i.index*n,memberIndex:a,tuples:e}}function w(e,t){var n,i,r=!0;for(e=e.members,t=t.members,n=0,i=e.length;i>n;n++)e[n].measure||t[n].measure||(r=r&&e[n].name===t[n].name);return r}function _(e,t){var n,i,r,o,a,s,l,c=0;for(n=0,i=e.length;i>n;n++){if(r=e[n],w(r,t))return{tuple:r,index:c};for(c++,a=0,s=r.members.length;s>a;a++)if(l=r.members[a],!l.measure&&(o=_(l.children,t),c+=o.index,o.tuple))return{tuple:o.tuple,index:c}}return{index:c}}function b(e,t){var n,i,r,o="";for(i=0,r=e.length;r>i;i++)n=e[i],o+=n.name,t[o]||(t[o]=n)}function x(e,t){var n,i,r,o,a=e.members,s="",l="";for(n=0,i=a.length;i>n;n++){if(r=a[n],o){if(t[s+r.name]){s+=r.name,o=t[s];continue}return t[s+r.parentName]?t[s+r.parentName]:(r.parentName&&(l+=r.parentName),t[l])}if(s+=r.name,o=t[r.parentName],!o&&(o=t[s],!o))return null;o&&(l+=o.name)}return o}function k(e,t){var n,i,r,o;if(0===t.length)return-1;for(n=t[0],i=e.members,r=0,o=i.length;o>r;r++)if(i[r].name==n)return r}function C(n,i){if(!(0>i)){var r={name:"Measures",measure:!0,children:[e.extend({members:[],dataIndex:n.dataIndex},n.members[i])]};n.members.splice(i,1,r),n.dataIndex=t}}function S(e,t){var n,i,r,o,a,s;if(1>e.length)return[];for(n=[],i={},r=k(e[0],t),o=0;e.length>o;o++)a=e[o],a.dataIndex=o,C(a,r),s=x(a,i),s?s.children.push(0>r||!s.measure?a:a.members[r].children[0]):n.push(a),b(a.members,i);return n}function T(e,t){var n,i,r,o,a,s,l,c;if(!e||!e.length)return t;for(n=[],i=A(e),r=i.length,o=Math.max(t.length/r,1),a=0;r>a;a++)for(l=o*a,c=o*i[a],s=0;o>s;s++)n[l+s]=t[c+s];return n}function D(e,t){var n,i,r,o,a,s,l;if(!e||!e.length)return t;for(n=[],i=A(e),r=i.length,o=Math.max(t.length/r,1),s=0;o>s;s++)for(l=r*s,a=0;r>a;a++)n[l+a]=t[i[a]+l];return n}function A(e){var n,i,r,o,a,s,l;for(e=e.slice(),n=[],i=e.shift();i;){for(i.dataIndex!==t&&n.push(i.dataIndex),a=0,r=0,o=i.members.length;o>r;r++)l=i.members[r],s=l.children,l.measure?[].splice.apply(e,[0,0].concat(s)):[].splice.apply(e,[a,0].concat(s)),a+=s.length;i=e.shift()}return n}function P(e,t){var n,i=[];for(n=0;e.length>n;n++)i.push(t(e[n]));return i}function E(e){var t=e.split(".");return t.length>2?t[0]+"."+t[1]:e}function M(e){var t,n,i,r=e.slice(0);for(t=0;e.length>t;t++)for(n=E(e[t].name),i=t+1;r.length>i;)0===r[i].name.indexOf(n)?r.splice(i,1):i++;return r}function I(e,t){var n,i,r,o=[];for(n=0;e.length>n;n++)i=e[n].name,r=E(t),(t==i||0!==i.indexOf(r))&&o.push(e[n]);return o}function z(e){var t,n,i,r,o,a,s,l={};for(t=0;e.length>t;t++)for(n=e[t].name,i=E(n),r=0;e.length>r;r++)o=e[r].name,0===o.indexOf(i)&&o!==n&&(l[n]=e[t]);a=[];for(s in l)a.push(l[s]);return a}function L(e,t){return P(e,function(e){var n,i=e.name,r=!1;for(n=0;t.length>n;n++)if(i===t[n]){r=!0;break}return e.expand&&r&&(i+=".Children"),i})}function B(e){return P(e,function(e){var t=e.name;return e.expand&&(t+=".Children"),t})}function F(e){return P(e,function(e){return e.name})}function R(e){var t,n="CROSSJOIN({";return e.length>2?(t=e.pop(),n+=R(e)):(n+=e.shift(),t=e.pop()),n+="},{",n+=t,n+="})"}function O(e,t){var n=e;return t.length>1&&n.push("{"+t.join(",")+"}"),R(n)}function N(e){var t,n=[];for(t=0;e.length>t;t++)e[t].expand&&n.push(e[t]);return n}function H(t,n){var i,r,o,a,s,l,c,d,u,h,f,p="";if(t=t||[],i=F(M(t)),r=N(t),i.length>1||n.length>1){if(p+=O(i,n),r.length)for(o=0,c=[],d=z(t),u=[],a=0;r.length>a;a++){for(s=o;r.length>s;s++)l=r[s].name,h=M(t),e.inArray(r[s],d)>-1&&(h=I(t,l)),f=O(L(h,c.concat(l)),n),-1==e.inArray(f,u)&&(p+=",",p+=f,u.push(f));o++,c.push(r[a].name),c.shift()}}else r.length&&(i=i.concat(B(t))),p+=i.join(",");return p}function V(e){var t="",n=e.value,i=e.field,r=e.operator;return"in"==r?(t+="{",t+=n,t+="}"):(t+="Filter(",t+=i+".Children",t+=st.format(G[r],i,n),t+=")"),t}function U(e,t){var n,i,r="",o=e.filters,a=o.length;for(i=a-1;i>=0;i--)n="SELECT (",n+=V(o[i]),n+=") ON 0",i==a-1?(n+=" FROM ["+t+"]",r=n):r=n+" FROM ( "+r+" )";return r}function W(e,t,n){var i,r,o="";if(t){o+="<"+e+">";for(r in t)i=t[r],n&&(r=r.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),o+="<"+r+">"+i+"</"+r+">";o+="</"+e+">"}else o+="<"+e+"/>";return o}function j(e){if(null==e)return[];var t=ht.call(e);return"[object Array]"!==t?[e]:e}function q(e){var t,n,i,r,o={tuples:[]},a=j(st.getter("Tuples.Tuple",!0)(e)),s=st.getter("Caption['#text']"),l=st.getter("UName['#text']"),c=st.getter("LName['#text']"),d=st.getter("LNum['#text']"),u=st.getter("CHILDREN_CARDINALITY['#text']",!0),h=st.getter("['@Hierarchy']"),f=st.getter("PARENT_UNIQUE_NAME['#text']",!0);for(t=0;a.length>t;t++){for(n=[],i=j(a[t].Member),r=0;i.length>r;r++)n.push({children:[],caption:s(i[r]),name:l(i[r]),levelName:c(i[r]),levelNum:d(i[r]),hasChildren:parseInt(u(i[r]),10)>0,parentName:f(i[r]),hierarchy:h(i[r])});o.tuples.push({members:n})}return o}var G,$,Q,Y,K,X,Z,J,et,tt,nt,it,rt,ot,at,st=window.kendo,lt=st.ui,ct=st.Class,dt=lt.Widget,ut=st.data.DataSource,ht={}.toString,ft=function(e){return e},pt=e.map,gt=e.extend,mt=st.isFunction,vt="change",yt="error",wt="progress",_t="stateReset",bt="<div/>",xt=".kendoPivotGrid",kt="__row_total__",Ct="dataBinding",St="dataBound",Tt="expandMember",Dt="collapseMember",At="k-i-arrow-s",Pt="k-i-arrow-e",Et="#: data.member.caption || data.member.name #",Mt='#: data.dataItem ? (data.dataItem.fmtValue || data.dataItem.value) : "" #',It='<table class="k-pivot-layout"><tr><td><div class="k-pivot-rowheaders"></div></td><td><div class="k-pivot-table k-state-default"></div></td></tr></table>',zt=ct.extend({init:function(e){this.options=gt({},this.options,e),this.dimensions=this._normalizeDescriptors("field",this.options.dimensions),this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(e,t){var n,i,r,o;if(t=t||{},n={},"[object Array]"===ht.call(t)){for(r=0,o=t.length;o>r;r++)i=t[r],"string"==typeof i?n[i]={}:i[e]&&(n[i[e]]=i);t=n}return t},_asTuples:function(e,n,i){var r,o,a,s,l,c,d,u,h;if(i=i||[],r=this.dimensions||[],o=[],u=i.length||1,n.length||i.length)for(c=0;u>c;c++){for(a={members:[]},s=0,l=n.length;l>s;s++)a.members[a.members.length]={children:[],caption:(r[n[s].name]||{}).caption||"All",name:n[s].name,levelName:n[s].name,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:n[s].name};u>1&&(a.members[a.members.length]={children:[],caption:i[c].caption,name:i[c].name,levelName:"MEASURES",levelNum:"0",hasChildren:!1,parentName:t,hierarchy:"MEASURES"}),o[o.length]=a}for(h in e)for(c=0;u>c;c++){for(d={members:[]},s=0,l=n.length;l>s;s++)d.members[d.members.length]=0===e[h].parentName.indexOf(n[s].name)?{children:[],caption:e[h].value,name:e[h].name,levelName:e[h].name,levelNum:1,hasChildren:!1,parentName:n[s].name,hierarchy:n[s].name}:{children:[],caption:(r[n[s].name]||{}).caption||"All",name:n[s].name,levelName:n[s].name,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:n[s].name};u>1&&(d.members[d.members.length]={children:[],caption:i[c].caption,name:i[c].name,levelName:"MEASURES",levelNum:"0",hasChildren:!0,parentName:t,hierarchy:"MEASURES"}),o[o.length]=d}return o},_toDataArray:function(e,t,n,i,r){var o,a,s,l,c,d,u={};if(n&&n.length)for(o=this.measures||{},a=0;n.length>a;a++)s=o[n[a]],s.format&&(u[n[a]]=s.format);l=[],c=0,r(l,c,e,kt,u,t);for(d in e)d!==kt&&(c+=i,r(l,c,e,d,u,t));return l},_matchDescriptors:function(e,t,n,i){for(var r,o,a,s,l;i>0;)if(r=t[--i],o=r.name.split("&"),o.length>1&&(a=o[0],s=o[1],l=n[a],l(e)!=s))return!1;return!0},_isExpanded:function(e){for(var t=0,n=e.length;n>t;t++)if(e[t].expand)return!0;return!1},_calculateAggregate:function(e,t,n){var i,r,o,a={};for(o=0;e.length>o;o++)r=e[o].name,i=n.aggregates[r]||0,a[r]=e[o].aggregator(t,i);return a},_processColumns:function(e,n,i,r,o,a,s,l){var c,d,u,h,f,p;for(p=0;n.length>p;p++)if(d=n[p],d.expand){if(!this._matchDescriptors(o,n,i,p))continue;c=i[d.name](o),c=c!==t?""+c:c,u=d.name+"&"+c,h=r[u]||{index:s.columnIndex,name:u,parentName:d.name,value:c},f=a.items[u]||{aggregates:{}},a.items[u]={index:h.index,aggregates:this._calculateAggregate(e,o,f)},l&&(r[u]||s.columnIndex++,r[u]=h)}},_measureAggregators:function(e){var t,n,i,r,o=e.measures||[],a=this.measures||{},s=[];if(o.length)for(i=0,r=o.length;r>i;i++)t=o[i],n=a[t],n&&s.push({name:t,caption:n.caption,aggregator:d(n)});else s.push({name:"default",caption:"default",aggregator:function(){return 1}});return s},_buildGetters:function(e){var t,n,i,r,o={};for(i=0,r=e.length;r>i;i++)t=e[i],n=t.name.split("&"),n.length>1?o[n[0]]=st.getter(n[0],!0):o[t.name]=st.getter(t.name,!0);return o},process:function(e,i){var r,o,a,s,d,u,h,f,p,g,m,v,y,w,_,b,x,k,C,S,T,D,A;if(e=e||[],i=i||{},r=i.measures||[],o="rows"===i.measuresAxis,a=(o?i.rows:i.columns)||[],s=(o?i.columns:i.rows)||[],!a.length&&s.length&&(!r.length||r.length&&o)&&(a=s,s=[],o=!1),a.length||s.length||(o=!1),!a.length&&r.length&&(a=n(i.measures)),d={},u={},h={},p={columnIndex:0},g=this._measureAggregators(i),m=this._buildGetters(a),v=this._buildGetters(s),y=!1,a.length||s.length)for(w=this._isExpanded(s),y=!0,_=0,b=e.length;b>_;_++)for(x=d[kt]||{items:{},aggregates:{}},this._processColumns(g,a,m,u,e[_],x,p,!w),x.aggregates=this._calculateAggregate(g,e[_],x),d[kt]=x,k=0,C=s.length;C>k;k++)if(S=s[k],S.expand){if(!this._matchDescriptors(e[_],s,v,k))continue;f=v[S.name](e[_]),f=f!==t?""+f:f,h[f]={name:S.name+"&"+f,parentName:S.name,value:f},T=d[f]||{items:{},aggregates:{}},this._processColumns(g,a,m,u,e[_],T,p,!0),T.aggregates=this._calculateAggregate(g,e[_],T),d[f]=T}return y&&e.length?(!(g.length>1)||i.columns&&i.columns.length||(a=[]),u=this._asTuples(u,a,g),h=this._asTuples(h,s,[]),D=u.length,o&&(D=1,A=u,u=h,h=A),d=this._toDataArray(d,u.length,i.measures,D,o?l:c)):d=u=h=[],{axes:{columns:{tuples:u},rows:{tuples:h}},data:d}}}),Lt=ct.extend({init:function(e,t){this.transport=t,this.options=t.options||{},this.transport.discover||mt(e.discover)&&(this.discover=e.discover)},read:function(e){return this.transport.read(e)},update:function(e){return this.transport.update(e)},create:function(e){return this.transport.create(e)},destroy:function(e){return this.transport.destroy(e)},discover:function(e){return this.transport.discover?this.transport.discover(e):(e.success({}),t)},catalog:function(n){var i,r=this.options||{};return n===t?(r.connection||{}).catalog:(i=r.connection||{},i.catalog=n,this.options.connection=i,e.extend(this.transport.options,{connection:i}),t)},cube:function(e){var n,i=this.options||{};return e===t?(i.connection||{}).cube:(n=i.connection||{},n.cube=e,this.options.connection=n,gt(!0,this.transport.options,{connection:n}),t)}}),Bt=ut.extend({init:function(e){var t,i;ut.fn.init.call(this,gt(!0,{},{schema:{axes:ft,cubes:ft,catalogs:ft,measures:ft,dimensions:ft,hierarchies:ft,levels:ft,members:ft}},e)),this.options.schema&&this.options.schema.cube&&(this.cubeBuilder=new zt(this.options.schema.cube)),this.transport=new Lt(this.options.transport||{},this.transport),this._columns=n(this.options.columns),this._rows=n(this.options.rows),t=this.options.measures||[],i="columns",null!==this.options.measures&&"[object Object]"===ht.call(this.options.measures)&&(t=this.options.measures.values||[],i=this.options.measures.axis||"columns"),this._measures=t||[],this._measuresAxis=i,this._axes={}},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},catalog:function(e){return e===t?this.transport.catalog():(this.transport.catalog(e),this._mergeState({}),this._axes={},this.data([]),t)},cube:function(e){return e===t?this.transport.cube():(this.transport.cube(e),this._axes={},this._mergeState({}),this.data([]),t)},axes:function(){return this._axes},columns:function(e){return e===t?this._columns:(this._clearAxesData=!0,this._columns=n(e),this.query({columns:e,rows:this.rowsAxisDescriptors(),measures:this.measures()}),t)},rows:function(e){return e===t?this._rows:(this._clearAxesData=!0,this._rows=n(e),this.query({columns:this.columnsAxisDescriptors(),rows:e,measures:this.measures()}),t)},measures:function(e){return e===t?this._measures:(this._clearAxesData=!0,this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:e}),t)},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(e,t){var i,r,o="columns"===t?"columns":"rows",a="columns"===t?"rows":"columns",l=n(e),c=l[l.length-1].name;for(this._lastExpanded=o,l=s(this.axes()[o],l,this.measures()),i=0;l.length>i;i++)if(l[i].name===c){if(l[i].expand)return;l[i].expand=!0}else l[i].expand=!1;r={},r[o]=l,r[a]=this._descriptorsForAxis(a),this._query(r)},_descriptorsForAxis:function(e){var t=this.axes(),n=this[e]()||[];return t&&t[e]&&t[e].tuples&&t[e].tuples[0]&&(n=r(t[e].tuples||[])),n},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(e,t){this._view=e,t=t||{},t.items=t.items||this._view,this.trigger(vt,t)},_query:function(e){var t=this;e||(this._clearAxesData=!0),t.query(gt({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},e))},query:function(e){var t=this._mergeState(e);this._data.length&&this.cubeBuilder?(this._params(t),this._updateLocalData(this._pristineData)):this.read(t)},_mergeState:function(e){return e=ut.fn._mergeState.call(this,e),e!==t&&(this._measures=j(e.measures),e.columns?e.columns=n(e.columns):e.columns||(this._columns=[]),e.rows?e.rows=n(e.rows):e.rows||(this._rows=[])),e},filter:function(e){return e===t?this._filter:(this._clearAxesData=!0,this._query({filter:e,page:1}),t)},expandColumn:function(e){this._expandPath(e,"columns")},expandRow:function(e){this._expandPath(e,"rows")},success:function(e){var t;this.cubeBuilder&&(t=(this.reader.data(e)||[]).slice(0)),ut.fn.success.call(this,e),t&&(this._pristineData=t)},_processResult:function(e,t){var n,i,r,o,a,s,l,c,d;return this.cubeBuilder&&(n=this.cubeBuilder.process(e,this._requestData),e=n.data,t=n.axes),s=this.columns().length,l=this.rows().length,c=t.columns&&t.columns.tuples,s||!l||!c||!this._rowMeasures().length&&this.measures().length||(t={columns:{},rows:t.columns}),s||l||"rows"!==this.measuresAxis()||!c||(t={columns:{},rows:t.columns}),this._axes={columns:m(this._axes.columns),rows:m(this._axes.rows)},t={columns:m(t.columns),rows:m(t.rows)},e=this._normalizeData(e,t.columns.tuples.length,t.rows.tuples.length),"rows"==this._lastExpanded?(i=t.columns.tuples,o=this._columnMeasures(),r=u(t.columns,this._axes.columns,o),r&&(a="columns",t.columns=r,h(i,r.tuples,t.rows.tuples.length,o,e),e=this._normalizeData(e,g(t.columns.tuples,o),t.rows.tuples.length))):"columns"==this._lastExpanded&&(i=t.rows.tuples,o=this._rowMeasures(),r=u(t.rows,this._axes.rows,o),r&&(a="rows",t.rows=r,f(i,r.tuples,t.columns.tuples.length,o,e),e=this._normalizeData(e,g(t.rows.tuples,o),t.columns.tuples.length))),this._lastExpanded=null,d=this._mergeAxes(t,e,a),this._axes=d.axes,d.data},_readData:function(e){var t=this.reader.axes(e),n=this.reader.data(e);return this._processResult(n,t)},_mergeAxes:function(e,t,n){var i,r,o,a,s,l=this._columnMeasures(),c=this._rowMeasures(),d=this.axes(),u=e.rows.tuples.length,h=g(d.columns.tuples,l),f=e.columns.tuples.length;return"columns"==n?(f=h,r=e.columns.tuples):(r=S(e.columns.tuples,l),t=D(r,t)),o=y(d.columns.tuples,r,l),"rows"==n?(u=g(e.rows.tuples,c),r=e.rows.tuples):(r=S(e.rows.tuples,c),t=T(r,t)),a=y(d.rows.tuples,r,c),d.columns.tuples=o.tuples,d.rows.tuples=a.tuples,h!==g(d.columns.tuples,l)?(i=o.index+v(o.parsedRoot,o.memberIndex,l),s=h+f,t=this._mergeColumnData(t,i,u,f,s)):(i=a.index+v(a.parsedRoot,a.memberIndex,c),t=this._mergeRowData(t,i,u,f)),{axes:d,data:t}},_mergeColumnData:function(e,t,n,i,r){var o,a,s,l=this.data().toJSON(),c=0,d=Math.max(this._columnMeasures().length,1);for(n=Math.max(n,1),l.length>0&&(c=d,r-=d),o=0;n>o;o++)a=t+o*r,s=e.splice(0,i),s.splice(0,c),[].splice.apply(l,[a,0].concat(s));return l},_mergeRowData:function(e,t,n,i){var r,o,a,s=this.data().toJSON(),l=Math.max(this._rowMeasures().length,1);for(i=Math.max(i,1),s.length>0&&(n-=l,e.splice(0,i*l)),r=0;n>r;r++)a=e.splice(0,i),o=t*i+r*i,[].splice.apply(s,[o,0].concat(a));return s},_columnMeasures:function(){var e=this.measures(),t=[];return"columns"===this.measuresAxis()&&(0===this.columns().length?t=e:e.length>1&&(t=e)),t},_rowMeasures:function(){var e=this.measures(),t=[];return"rows"===this.measuresAxis()&&(0===this.rows().length?t=e:e.length>1&&(t=e)),t},_updateLocalData:function(e,t){this.cubeBuilder&&(t&&(this._requestData=t),e=this._processResult(e)),this._data=this._observe(e),this._ranges=[],this._addRange(this._data),this._total=this._data.length,this._pristineTotal=this._total,this._process(this._data)},data:function(e){var n=this;return e===t?n._data:(this._pristineData=e.slice(0),this._updateLocalData(e,{columns:this.columns(),rows:this.rows(),measures:this.measures()}),t)},_normalizeData:function(e,t,n){var i,r,o,a=(t||1)*(n||1),s=Array(a);if(e.length===a)return e;for(r=0,o=s.length;o>r;r++)s[r]={value:"",fmtValue:"",ordinal:r};for(r=0,o=e.length;o>r;r++)i=e[r],i&&(s[i.ordinal]=i);return s},discover:function(t,n){var i=this,r=i.transport;return e.Deferred(function(e){r.discover(gt({success:function(t){t=i.reader.parse(t),i._handleCustomErrors(t)||(n&&(t=n(t)),e.resolve(t))},error:function(t,n,r){e.reject(t),i.error(t,n,r)}},t))}).promise().done(function(){i.trigger("schemaChange")})},schemaMeasures:function(){var e=this;return e.discover({data:{command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.measures(t)})},schemaDimensions:function(){var e=this;return e.discover({data:{command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.dimensions(t)})},schemaHierarchies:function(e){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}}},function(e){return t.reader.hierarchies(e)})},schemaLevels:function(e){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}}},function(e){return t.reader.levels(e)})},schemaCubes:function(){var e=this;return e.discover({data:{command:"schemaCubes",restrictions:{catalogName:e.transport.catalog()}}},function(t){return e.reader.cubes(t)})},schemaCatalogs:function(){var e=this;return e.discover({data:{command:"schemaCatalogs"}},function(t){return e.reader.catalogs(t)})},schemaMembers:function(e){var t=this;return t.discover({data:{command:"schemaMembers",restrictions:gt({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)}},function(e){return t.reader.members(e)})},_params:function(e){this._clearAxesData&&(this._axes={},this._data=this._observe([]),this._clearAxesData=!1,this.trigger(_t));var t=ut.fn._params.call(this,e);return t=gt({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t),this.cubeBuilder&&(this._requestData=t),t}});Bt.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},n=t.data;if(t.data=n,!(t instanceof Bt)&&t instanceof st.data.DataSource)throw Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof Bt?t:new Bt(t)},G={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") = 0',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', NOT {0}.CurrentMember.MEMBER_CAPTION = "{1}"'},$={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS"},Q={read:function(e){var t,n,i,r,o='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>';return o+="SELECT NON EMPTY {",t=e.columns||[],n=e.rows||[],i=e.measures||[],r="rows"===e.measuresAxis,!t.length&&n.length&&(!i.length||i.length&&r)&&(t=n,n=[],r=!1),t.length||n.length||(r=!1),t.length?o+=H(t,r?[]:i):i.length&&!r&&(o+=i.join(",")),o+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(n.length||r&&i.length>1)&&(o+=", NON EMPTY {",o+=n.length?H(n,r?i:[]):i.join(","),o+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),e.filter?(o+=" FROM ",o+="(",o+=U(e.filter,e.connection.cube),o+=")"):o+=" FROM ["+e.connection.cube+"]",1==i.length&&t.length&&(o+=" WHERE ("+i.join(",")+")"),o+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>",o.replace(/\&/g,"&amp;")},discover:function(t){t=t||{};var n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return n+="<RequestType>"+($[t.command]||t.command)+"</RequestType>",n+="<Restrictions>"+W("RestrictionList",t.restrictions,!0)+"</Restrictions>",t.connection&&t.connection.catalog&&(t.properties=e.extend({},{Catalog:t.connection.catalog},t.properties)),n+="<Properties>"+W("PropertyList",t.properties)+"</Properties>",n+="</Discover></Body></Envelope>"}},Y=st.data.RemoteTransport.extend({init:function(e){var t=e;e=this.options=gt(!0,{},this.options,e),st.data.RemoteTransport.call(this,e),mt(t.discover)?this.discover=t.discover:"string"==typeof t.discover?this.options.discover={url:t.discover}:t.discover||(this.options.discover=this.options.read)},setup:function(t,n){return t.data=t.data||{},e.extend(!0,t.data,{connection:this.options.connection}),st.data.RemoteTransport.fn.setup.call(this,t,n)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(e,t){return Q[t](e,t)}},discover:function(t){return e.ajax(this.setup(t,"discover"))}}),K={cubes:{name:st.getter("CUBE_NAME['#text']",!0),caption:st.getter("CUBE_CAPTION['#text']",!0),description:st.getter("DESCRIPTION['#text']",!0),type:st.getter("CUBE_TYPE['#text']",!0)},catalogs:{name:st.getter("CATALOG_NAME['#text']",!0),description:st.getter("DESCRIPTION['#text']",!0)},measures:{name:st.getter("MEASURE_NAME['#text']",!0),caption:st.getter("MEASURE_CAPTION['#text']",!0),uniqueName:st.getter("MEASURE_UNIQUE_NAME['#text']",!0),description:st.getter("DESCRIPTION['#text']",!0),aggregator:st.getter("MEASURE_AGGREGATOR['#text']",!0),groupName:st.getter("MEASUREGROUP_NAME['#text']",!0),displayFolder:st.getter("MEASURE_DISPLAY_FOLDER['#text']",!0),defaultFormat:st.getter("DEFAULT_FORMAT_STRING['#text']",!0)},dimensions:{name:st.getter("DIMENSION_NAME['#text']",!0),caption:st.getter("DIMENSION_CAPTION['#text']",!0),description:st.getter("DESCRIPTION['#text']",!0),uniqueName:st.getter("DIMENSION_UNIQUE_NAME['#text']",!0),defaultHierarchy:st.getter("DEFAULT_HIERARCHY['#text']",!0),type:st.getter("DIMENSION_TYPE['#text']",!0)},hierarchies:{name:st.getter("HIERARCHY_NAME['#text']",!0),caption:st.getter("HIERARCHY_CAPTION['#text']",!0),description:st.getter("DESCRIPTION['#text']",!0),uniqueName:st.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),dimensionUniqueName:st.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:st.getter("HIERARCHY_DISPLAY_FOLDER['#text']",!0),origin:st.getter("HIERARCHY_ORIGIN['#text']",!0),defaultMember:st.getter("DEFAULT_MEMBER['#text']",!0)},levels:{name:st.getter("LEVEL_NAME['#text']",!0),caption:st.getter("LEVEL_CAPTION['#text']",!0),description:st.getter("DESCRIPTION['#text']",!0),uniqueName:st.getter("LEVEL_UNIQUE_NAME['#text']",!0),dimensionUniqueName:st.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:st.getter("LEVEL_DISPLAY_FOLDER['#text']",!0),orderingProperty:st.getter("LEVEL_ORDERING_PROPERTY['#text']",!0),origin:st.getter("LEVEL_ORIGIN['#text']",!0),hierarchyUniqueName:st.getter("HIERARCHY_UNIQUE_NAME['#text']",!0)},members:{name:st.getter("MEMBER_NAME['#text']",!0),caption:st.getter("MEMBER_CAPTION['#text']",!0),uniqueName:st.getter("MEMBER_UNIQUE_NAME['#text']",!0),dimensionUniqueName:st.getter("DIMENSION_UNIQUE_NAME['#text']",!0),hierarchyUniqueName:st.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),levelUniqueName:st.getter("LEVEL_UNIQUE_NAME['#text']",!0),childrenCardinality:st.getter("CHILDREN_CARDINALITY['#text']",!0)}},X=st.data.XmlDataReader.extend({parse:function(e){var t=st.data.XmlDataReader.fn.parse(e.replace(/<(\/?)(\w|-)+:/g,"<$1"));return st.getter("['Envelope']['Body']",!0)(t)},errors:function(e){var t=st.getter("['Fault']",!0)(e);return t?[{faultstring:st.getter("faultstring['#text']",!0)(t),faultcode:st.getter("faultcode['#text']",!0)(t)}]:null},axes:function(e){var t,n,i;return e=st.getter("ExecuteResponse.return.root",!0)(e),t=j(st.getter("Axes.Axis",!0)(e)),n=q(t[0]),i={},t.length>2&&(i=q(t[1])),{columns:n,rows:i}},data:function(e){var t,n,i,r,o,a;for(e=st.getter("ExecuteResponse.return.root",!0)(e),t=j(st.getter("CellData.Cell",!0)(e)),n=[],i=st.getter("['@CellOrdinal']"),r=st.getter("Value['#text']"),o=st.getter("FmtValue['#text']"),a=0;t.length>a;a++)n.push({value:r(t[a]),fmtValue:o(t[a]),ordinal:parseInt(i(t[a]),10)});return n},_mapSchema:function(e,t){var n,i,r,o,a;for(e=st.getter("DiscoverResponse.return.root",!0)(e),n=j(st.getter("row",!0)(e)),i=[],r=0;n.length>r;r++){o={};for(a in t)o[a]=t[a](n[r]);i.push(o)}return i},measures:function(e){return this._mapSchema(e,K.measures)},hierarchies:function(e){return this._mapSchema(e,K.hierarchies)},levels:function(e){return this._mapSchema(e,K.levels)},dimensions:function(e){return this._mapSchema(e,K.dimensions)},cubes:function(e){return this._mapSchema(e,K.cubes)},catalogs:function(e){return this._mapSchema(e,K.catalogs)},members:function(e){return this._mapSchema(e,K.members)}}),gt(!0,st.data,{PivotDataSource:Bt,XmlaTransport:Y,XmlaDataReader:X,PivotCubeBuilder:zt,transports:{xmla:Y},readers:{xmla:X}}),st.ui.PivotSettingTarget=dt.extend({init:function(t,n){dt.fn.init.call(this,t,n),this.element.addClass("k-pivot-setting"),this.dataSource=st.data.PivotDataSource.create(n.dataSource),this._refreshHandler=e.proxy(this.refresh,this),this.dataSource.first(vt,this._refreshHandler),n.template||(this.options.template="<div data-"+st.ns+'name="${data.name || data}">${data.name || data}'+(this.options.enabled?'<a class="k-button k-button-icon k-button-bare"><span class="k-icon k-setting-delete"></span></a>':"")+"</div>"),this.template=st.template(this.options.template),this.emptyTemplate=st.template(this.options.emptyTemplate),this._sortable();var i=this;this.element.on("click"+xt,".k-setting-delete",function(){var t=e(this).closest("["+st.attr("name")+"]").attr(st.attr("name"));t&&i.remove(t)}),n.filterable&&(this.fieldMenu=new lt.PivotFieldMenu(this.element,{messages:this.options.messages.fieldMenu,filter:".k-setting-filter",dataSource:this.dataSource})),this.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:!1,emptyTemplate:"<div class='k-empty'>${data}</div>",setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(vt,this._refreshHandler),this.dataSource=this.options.dataSource=e,this.fieldMenu&&this.fieldMenu.setDataSource(e),e.first(vt,this._refreshHandler),this.refresh()},_sortable:function(){var e=this;e.options.enabled&&(this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,filter:">:not(.k-empty)",hint:e.options.hint,cursor:"move",start:function(e){e.item.focus().blur()},change:function(t){var n=t.item.attr(st.attr("name"));"receive"==t.action?e.add(n):"remove"==t.action?e.remove(n):"sort"==t.action&&e.move(n,t.newIndex)}}).data("kendoSortable"))},_indexOf:function(e,t){var n,i,r=-1;for(n=0,i=t.length;i>n;n++)if(t[n].name===e||t[n]===e){r=n;break}return r},validate:function(e){var t,n,i=2==e.type||"aggregator"in e;return i?"measures"===this.options.setting:"measures"===this.options.setting?i:(t=this.dataSource[this.options.setting](),n=e.defaultHierarchy||e.uniqueName,this._indexOf(n,t)>-1?!1:(t=this.dataSource["columns"===this.options.setting?"rows":"columns"](),this._indexOf(n,t)>-1?!1:!0))},add:function(e){var t=this.dataSource[this.options.setting](),n=this._indexOf(e,t);-1==n&&(t.push(e),this.dataSource[this.options.setting](t))
},move:function(e,t){var n=this.dataSource[this.options.setting](),i=this._indexOf(e,n);i>-1&&(n.splice(i,1),n.splice(t,0,e),this.dataSource[this.options.setting](n))},remove:function(e){var t=this.dataSource[this.options.setting](),n=this._indexOf(e,t);n>-1&&(t.splice(n,1),this.dataSource[this.options.setting](t))},refresh:function(){var e=this.dataSource[this.options.setting](),t=this.emptyTemplate(this.options.messages.empty);e.length&&(t=st.render(this.template,e)),this.element.html(t)},destroy:function(){dt.fn.destroy.call(this),this.dataSource.unbind(vt,this._refreshHandler),this.element.off(xt),this.sortable&&this.sortable.destroy(),this.fieldMenu&&this.fieldMenu.destroy(),this.element=null,this._refreshHandler=null}}),Z=dt.extend({init:function(n,i){var r,o,a=this;dt.fn.init.call(a,n,i),a._dataSource(),a._bindConfigurator(),a._wrapper(),a._createLayout(),a._columnBuilder=r=new rt,a._rowBuilder=o=new ot,a._contentBuilder=new at,a._templates(),a.columnsHeader.add(a.rowsHeader).on("click","span.k-icon",function(){var n,i,s,l,c=e(this),d=r,u="expandColumn",h=c.attr(st.attr("path")),f={axis:"columns",path:e.parseJSON(h)};c.parent().is("td")&&(d=o,u="expandRow",f.axis="rows"),i=c.hasClass(At),s=d.metadata[h],l=s.expanded===t,n=i?Dt:Tt,a.trigger(n,f)||(d.metadata[h].expanded=!i,c.toggleClass(At,!i).toggleClass(Pt,i),!i&&l?a.dataSource[u](f.path):a.refresh())}),a._scrollable(),a.options.autoBind&&a.dataSource.fetch(),st.notify(a)},events:[Ct,St,Tt,Dt],options:{name:"PivotGrid",autoBind:!0,reorderable:!0,filterable:!1,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var e=this.options.dataCellTemplate,t=this.options.columnHeaderTemplate,n=this.options.rowHeaderTemplate;this._columnBuilder.template=st.template(t||Et,{useWithBlock:!!t}),this._contentBuilder.template=st.template(e||Mt,{useWithBlock:!!e}),this._rowBuilder.template=st.template(n||Et,{useWithBlock:!!n})},_bindConfigurator:function(){var t=this.options.configurator;t&&e(t).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=e(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(e,t){var n,i=this._contentBuilder,r=i.columnIndexes[e||0],o=i.rowIndexes[t||0];return r&&o?(n=o.index*i.rowLength+r.index,{columnTuple:r.tuple,rowTuple:o.tuple,measure:r.measure||o.measure,dataItem:this.dataSource.view()[n]}):null},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.measuresTarget&&this.measuresTarget.setDataSource(e),this.rowsTarget&&this.rowsTarget.setDataSource(e),this.columnsTarget&&this.columnsTarget.setDataSource(e),this._bindConfigurator(),this.options.autoBind&&e.fetch()},setOptions:function(e){dt.fn.setOptions.call(this,e),this._templates()},_dataSource:function(){var t=this,n=t.options.dataSource;n=e.isArray(n)?{data:n}:n,t.dataSource&&this._refreshHandler?t.dataSource.unbind(vt,t._refreshHandler).unbind(_t,t._stateResetHandler).unbind(wt,t._progressHandler).unbind(yt,t._errorHandler):(t._refreshHandler=e.proxy(t.refresh,t),t._progressHandler=e.proxy(t._requestStart,t),t._stateResetHandler=e.proxy(t._stateReset,t),t._errorHandler=e.proxy(t._error,t)),t.dataSource=st.data.PivotDataSource.create(n).bind(vt,t._refreshHandler).bind(wt,t._progressHandler).bind(_t,t._stateResetHandler).bind(yt,t._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_stateReset:function(){this._columnBuilder.reset(),this._rowBuilder.reset()},_wrapper:function(){this.wrapper=this.element.addClass("k-widget k-pivot")},_measureFields:function(){this.measureFields=e(bt).addClass("k-pivot-toolbar k-header k-settings-measures"),this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(t,n){var i='<span tabindex="0" class="k-button" data-'+st.ns+'name="${data.name || data}">${data.name || data}',r="";return n.filterable&&(r+='<span class="k-icon k-filter k-setting-filter"></span>'),this.options.reorderable&&(r+='<span class="k-icon k-si-close k-setting-delete"></span>'),r&&(i+='<span class="k-field-actions">'+r+"</span>"),i+="</span>",new st.ui.PivotSettingTarget(t,e.extend({template:i,emptyTemplate:'<span class="k-empty">${data}</span>',enabled:this.options.reorderable,dataSource:this.dataSource},n))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}}),this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var t=this,n=e(It),i=n.find(".k-pivot-rowheaders"),r=n.find(".k-pivot-table"),o=e(bt).addClass("k-grid k-widget");t._measureFields(),t.columnFields=e(bt).addClass("k-pivot-toolbar k-header k-settings-columns"),t.rowFields=e(bt).addClass("k-pivot-toolbar k-header k-settings-rows"),t.columnsHeader=e('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />'),t.columnsHeader.parent().css("padding-right",st.support.scrollbar()),t.rowsHeader=e('<div class="k-grid k-widget k-alt"/>'),t.content=e('<div class="k-grid-content" />'),i.append(t.measureFields),i.append(t.rowFields),i.append(t.rowsHeader),o.append(t.columnsHeader.parent()),o.append(t.content),r.append(t.columnFields),r.append(o),t.wrapper.append(n),t.columnsHeaderTree=new st.dom.Tree(t.columnsHeader[0]),t.rowsHeaderTree=new st.dom.Tree(t.rowsHeader[0]),t.contentTree=new st.dom.Tree(t.content[0]),t._initSettingTargets()},_progress:function(e){st.ui.progress(this.wrapper,e)},_resize:function(){this.content[0].firstChild&&(this._setSectionsWidth(),this._setSectionsHeight(),this._setContentWidth(),this._setContentHeight())},_setSectionsWidth:function(){var e=this.rowsHeader,t=e.parent(".k-pivot-rowheaders").width("auto"),n=Math.max(this.measureFields.outerWidth(),this.rowFields.outerWidth());n=Math.max(e.children("table").width(),n),t.width(n)},_setSectionsHeight:function(){var e=this.measureFields.height("auto").height(),t=this.columnFields.height("auto").height(),n=this.rowFields.height("auto").innerHeight(),i=this.columnsHeader.height("auto").innerHeight(),r=n-this.rowFields.height(),o=t>e?t:e,a=i>n?i:n;this.measureFields.height(o),this.columnFields.height(o),this.rowFields.height(a-r),this.columnsHeader.height(a)},_setContentWidth:function(){var e=this.content.find("table"),t=this.content.width(),n=e.children("colgroup").children().length,i=100,r=n*this.options.columnWidth;r>t&&(i=Math.ceil(r/t*100)),e.add(this.columnsHeader.children("table")).css("min-width",i+"%")},_setContentHeight:function(){var e=this,n=e.content,i=e.rowsHeader,r=e.options.height,o=st.support.scrollbar(),a=n[0].offsetHeight===n[0].clientHeight;if(e.wrapper.is(":visible")){if(!r)return a&&(o=0),i.height(n.height()-o),t;r-=e.columnFields.outerHeight(),r-=e.columnsHeader.outerHeight(),2*o>=r&&(r=2*o+1),n.height(r),a&&(o=0),i.height(r-o)}},refresh:function(){var e,t=this,n=t.dataSource,i=n.axes(),r=(i.columns||{}).tuples||[],o=(i.rows||{}).tuples||[],a=t._columnBuilder,s=t._rowBuilder,l={},c={};t.trigger(Ct,{action:"rebind"})||(a.measures=n._columnMeasures(),t.columnsHeaderTree.render(a.build(r)),t.rowsHeaderTree.render(s.build(o)),l={indexes:a._indexes,measures:a.measures,metadata:a.metadata},c={indexes:s._indexes,measures:n._rowMeasures(),metadata:s.metadata},t.contentTree.render(t._contentBuilder.build(n.view(),l,c)),t._resize(),t.touchScroller?t.touchScroller.contentResized():(e=st.touchScroller(t.content),e&&e.movable&&(t.touchScroller=e,e.movable.bind("change",function(e){t.columnsHeader.scrollLeft(-e.sender.x),t.rowsHeader.scrollTop(-e.sender.y)}))),t._progress(!1),t.trigger(St))},_scrollable:function(){var t=this,n=t.columnsHeader,i=t.rowsHeader;t.content.scroll(function(){n.scrollLeft(this.scrollLeft),i.scrollTop(this.scrollTop)}),i.bind("DOMMouseScroll"+xt+" mousewheel"+xt,e.proxy(t._wheelScroll,t))},_wheelScroll:function(t){var n,i;t.ctrlKey||(n=st.wheelDeltaY(t),i=this.content.scrollTop(),n&&(t.preventDefault(),e(t.currentTarget).one("wheel"+xt,!1),this.rowsHeader.scrollTop(i+-n),this.content.scrollTop(i+-n)))}}),J=st.dom.element,et=st.dom.html,tt=st.dom.text,nt=function(e,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:e,parentMember:0!==t}},it=function(e,t){for(var n=[],i=0;t>=i;i++)n.push(e.members[i].name);return n},rt=ct.extend({init:function(){this.measures=1,this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[J("table",null,[n,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(J("col",null));return J("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.map={},this.rows=[],this.rootTuple=t,this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(J("tr",null,[J("th",null,[et("&nbsp;")])])),J("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,r,o=this.rows,a=o.length,s=0;a>s;s++)if(e=o[s],1!==e.rowSpan)for(i=e.children,n=0,t=i.length;t>n;n++)r=i[n],r.tupleAll&&(r.attr.rowSpan=e.rowSpan)},_rowIndex:function(e){for(var t=this.rows,n=t.length,i=0;n>i&&t[i]!==e;i++);return i},_rowLength:function(){var e=this.rows[0]?this.rows[0].children:[],t=e.length,n=0,i=0;if(t)for(;t>i;i++)n+=e[i].attr.colSpan||1;return n||(n=this.measures),n},_row:function(e,t,n){var i,r,o=this.rootTuple.members[t].name,a=e.members[t].levelNum,s=o+a,l=this.map,c=l[s];return c?(c.notFirst=!1,c.parentMember&&c.parentMember===n||(c.parentMember=n,c.colSpan=0)):(c=J("tr",null,[]),c.parentMember=n,c.colSpan=0,c.rowSpan=1,l[s]=c,i=l[o+(+a-1)],i&&(r=i.children,c.notFirst=r[1]&&-1===r[1].attr.className.indexOf("k-alt")?!0:i.notFirst),this.rows.splice(this._rowIndex(i)+1,0,c)),c},_measures:function(e,t,n){var i,r,o,a=this.map,s=a.measureRow;for(s||(s=J("tr",null,[]),a.measureRow=s,this.rows.push(s)),r=0,o=e.length;o>r;r++)i=e[r],s.children.push(J("th",{className:"k-header"+(n||"")},[this._content(i,t)]));return o},_content:function(e,t){return et(this.template({member:e,tuple:t}))},_cell:function(e,t){return J("th",{className:"k-header"+e},t)},_buildRows:function(e,n,i){var r,o,a,s,l,c,d,u,h,f,p=e.members,g=p[n],m=p[n+1],v=[],y=0;if(g.measure)return this._measures(g.children,e),t;if(u=st.stringify(it(e,n)),r=this._row(e,n,i),a=g.children,s=a.length,f=this.metadata[u],f||(this.metadata[u]=f=nt(+g.levelNum,n)),this._indexes.push({path:u,tuple:e}),g.hasChildren&&(f.expanded===!1&&(s=0,f.children=0),d={className:"k-icon "+(s?At:Pt)},d[st.attr("path")]=u,v.push(J("span",d))),v.push(this._content(g,e)),l=this._cell(r.notFirst?" k-first":"",v),r.children.push(l),r.colSpan+=1,s){for(c=this._cell(" k-alt",[this._content(g,e)]),r.children.push(c);s>y;y++)o=this._buildRows(a[y],n,g);h=o.colSpan,l.attr.colSpan=h,f.children=h,f.members=1,r.colSpan+=h,r.rowSpan=o.rowSpan+1,m&&(h=m.measure?this._measures(m.children,e," k-alt"):this._buildRows(e,n+1).colSpan,c.attr.colSpan=h,h-=1,f.members+=h,r.colSpan+=h)}else m&&(h=m.measure?this._measures(m.children,e):this._buildRows(e,n+1).colSpan,f.members=h,h>1&&(l.attr.colSpan=h,r.colSpan+=h-1));return f.children>f.maxChildren&&(f.maxChildren=f.children),f.members>f.maxMembers&&(f.maxMembers=f.members),(c||l).tupleAll=!0,r}}),ot=ct.extend({init:function(){this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[J("table",null,[n,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this.rows[0].children.length,t=[],n=0;e>n;n++)t.push(J("col",null));return J("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.rootTuple=t,this.rows=[],this.map={},this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(J("tr",null,[J("td",null,[et("&nbsp;")])])),J("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,r=this.rows,o=r.length,a=0,s=this.rootTuple.members,l=s[0].name,c=s.length,d=0,u=this.map;o>a;a++)for(e=r[a],d=0;c>d;d++)n=this[s[d].name],t=e.colSpan["dim"+d],t&&n>t.levelNum&&(t.attr.colSpan=n-t.levelNum+1);e=u[l],i=u[l+"all"],e&&(e.children[0].attr.className="k-first"),i&&(i.children[0].attr.className+=" k-first")},_row:function(e){var t=J("tr",null,e);return t.rowSpan=1,t.colSpan={},this.rows.push(t),t},_content:function(e,t){return et(this.template({member:e,tuple:t}))},_buildRows:function(e,t){var n,i,r,o,a,s,l,c,d,u=this.map,h=e.members,f=h[t],p=h[t+1],g=f.children,m=g.length,v=+f.levelNum+1,y=this.rootTuple.members[t].name,w=it(e,t-1).join(""),_=w+(f.parentName||""),b=u[_+"all"]||u[_],x=[];if(!b||b.hasChild?b=this._row():b.hasChild=!0,f.measure){for(c={className:b.allCell?"k-grid-footer":""},b.children.push(J("td",c,[this._content(g[0],e)])),b.rowSpan=m,d=1;m>d;d++)this._row([J("td",c,[this._content(g[d],e)])]);return b}if(u[w+f.name]=b,n=st.stringify(it(e,t)),o=this.metadata[n],o||(this.metadata[n]=o=nt(v-1,t)),this._indexes.push({path:n,tuple:e}),f.hasChildren&&(o.expanded===!1&&(m=0,o.children=0),a={className:"k-icon "+(m?At:Pt)},a[st.attr("path")]=n,x.push(J("span",a))),x.push(this._content(f,e)),l=J("td",{className:b.allCell&&!m?"k-grid-footer":""},x),l.levelNum=v,b.children.push(l),b.colSpan["dim"+t]=l,(!this[y]||v>this[y])&&(this[y]=v),m){for(b.allCell=!1,b.hasChild=!1,d=0;m>d;d++)i=this._buildRows(g[d],t),b!==i&&(b.rowSpan+=i.rowSpan);b.rowSpan>1&&(l.attr.rowSpan=b.rowSpan),o.children=b.rowSpan,s=J("td",{className:"k-grid-footer"},[this._content(f,e)]),s.levelNum=v,r=this._row([s]),r.colSpan["dim"+t]=s,r.allCell=!0,u[w+f.name+"all"]=r,p&&(i=this._buildRows(e,t+1),s.attr.rowSpan=i.rowSpan),b.rowSpan+=r.rowSpan,o.members=r.rowSpan}else p&&(b.hasChild=!1,this._buildRows(e,t+1),(s||l).attr.rowSpan=b.rowSpan,o.members=b.rowSpan);return o.children>o.maxChildren&&(o.maxChildren=o.children),o.members>o.maxMembers&&(o.maxMembers=o.members),b}}),at=ct.extend({init:function(){this.columnAxis={},this.rowAxis={}},build:function(e,n,i){var r,o,a=n.indexes[0],s=n.metadata[a?a.path:t];return this.columnAxis=n,this.rowAxis=i,this.data=e,this.rowLength=s?s.maxChildren+s.maxMembers:n.measures.length||1,this.rowLength||(this.rowLength=1),r=this._tbody(),o=this._colGroup(),[J("table",null,[o,r])]},_colGroup:function(){var e=this.columnAxis.measures.length||1,t=[],n=0;for(this.rows[0]&&(e=this.rows[0].children.length);e>n;n++)t.push(J("col",null));return J("colgroup",null,t)},_tbody:function(){return this.rows=[],this.data[0]?(this.columnIndexes=this._indexes(this.columnAxis),this.rowIndexes=this._indexes(this.rowAxis),this._buildRows()):this.rows.push(J("tr",null,[J("td",null,[et("&nbsp;")])])),J("tbody",null,this.rows)},_indexes:function(e){var n,i,r,o,a,s=[],l=e.indexes,c=e.metadata,d=e.measures,u=d.length||1,h=0,f=0,p=0,g=l.length;if(!g){for(r=0;u>r;r++)s[r]={index:r,measure:d[r],tuple:null};return s}for(;g>p;p++){if(n=l[p],i=c[n.path],o=i.children+i.members,a=0,o&&(o-=u),i.expanded===!1&&i.children!==i.maxChildren&&(a=i.maxChildren),i.parentMember&&0===i.levelNum&&(o=-1),o>-1){for(r=0;u>r;r++)s[o+f+r]={children:o,index:h,measure:d[r],tuple:n.tuple},h+=1;for(;s[f]!==t;)f+=1}h+=a}return s},_buildRows:function(){for(var e=this.rowIndexes,t=e.length,n=0;t>n;n++)this.rows.push(this._buildRow(e[n]))},_buildRow:function(e){for(var t,n,i,r=e.index*this.rowLength,o=this.columnIndexes,a=o.length,s=[],l=0;a>l;l++)t=o[l],i={},t.children&&(i.className="k-alt"),n=this.template({columnTuple:t.tuple,rowTuple:e.tuple,measure:t.measure||e.measure,dataItem:this.data[r+t.index]}),s.push(J("td",i,[et(n)]));return i={},e.children&&(i.className="k-grid-footer"),J("tr",i,s)}}),lt.plugin(Z)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});